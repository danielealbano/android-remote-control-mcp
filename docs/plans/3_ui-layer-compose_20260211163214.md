# Plan 3: UI Layer (MainActivity + Jetpack Compose)

**Branch**: `feat/ui-layer-compose`
**PR Title**: `Plan 3: UI layer with Jetpack Compose and Material Design 3`
**Created**: 2026-02-11 16:32:14

---

## Overview

This plan creates the full UI layer for the Android Remote Control MCP application using Jetpack Compose with Material Design 3. It builds on top of Plan 1 (project scaffolding) and Plan 2 (data layer with ServerConfig, ServerStatus, SettingsRepository, utilities).

The UI provides server configuration, control, and status monitoring through a single-screen layout with sections for server status, configuration, permissions, and connection info.

### Dependencies on Previous Plans

- **Plan 1**: Project scaffolding, Gradle build system, all dependencies in `libs.versions.toml`, stub `MainActivity.kt`
- **Plan 2**: `ServerConfig` data class, `ServerStatus` sealed class, `SettingsRepository` interface and implementation, `BindingAddress` enum, `CertificateSource` enum, `NetworkUtils`, `PermissionUtils`, Hilt bindings in `AppModule`

### Package Base

`com.danielealbano.androidremotecontrolmcp`

### Path References

- **Source root**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/`
- **Test root**: `app/src/test/kotlin/com/danielealbano/androidremotecontrolmcp/`
- **Android test root**: `app/src/androidTest/kotlin/com/danielealbano/androidremotecontrolmcp/`
- **Resources**: `app/src/main/res/`

---

## User Story 1: UI Layer with Jetpack Compose and Material Design 3

**As a** user of the Android Remote Control MCP application
**I want** a modern, responsive configuration and control interface
**So that** I can configure the MCP server settings, start/stop the server, check permissions, and view connection details for MCP clients.

### Acceptance Criteria / Definition of Done (High Level)

- [ ] Material Design 3 theme with light and dark mode support is defined (Color.kt, Type.kt, Theme.kt)
- [ ] Dynamic colors (Material You) are used on Android 12+ with fallback to custom color scheme
- [ ] MainViewModel manages all UI state via StateFlows, reads/writes settings through SettingsRepository
- [ ] HomeScreen composable renders all sections: ServerStatusCard, ConfigurationSection, PermissionsSection, ConnectionInfoCard
- [ ] ServerStatusCard displays server status with colored indicator and Start/Stop button
- [ ] ConfigurationSection provides inputs for binding address, port, bearer token, auto-start, HTTPS certificate settings
- [ ] ConfigurationSection disables editing when server is running
- [ ] Security warning dialog appears when user selects 0.0.0.0 binding address (text matches PROJECT.md exactly)
- [ ] PermissionsSection shows permission status and provides quick-link buttons to enable permissions
- [ ] ConnectionInfoCard displays IP, port, server URL (HTTPS or HTTP depending on configuration), and masked bearer token with copy functionality
- [ ] All interactive elements have minimum 48dp touch targets
- [ ] All icons/images have contentDescription for accessibility (TalkBack support)
- [ ] ServerLogsSection displays a bounded list (last 100 entries) of server log entries (empty at this stage; actual entries emitted in Plan 6)
- [ ] `ServerLogEntry` data class is defined with `timestamp`, `toolName`, `params` (truncated at 100 chars), and `durationMs` fields
- [ ] MainViewModel exposes `serverLogs: StateFlow<List<ServerLogEntry>>` (initially empty list)
- [ ] State hoisting pattern is used throughout composables
- [ ] Port validation (1-65535) shows inline error messages
- [ ] Hostname validation shows inline error messages
- [ ] `@Preview` annotations are provided for key composables
- [ ] MainActivity is updated to use AndroidRemoteControlMcpTheme and HomeScreen
- [ ] strings.xml is updated with all UI strings
- [ ] Unit tests for MainViewModel pass (port validation, binding address, token regeneration, auto-start, hostname validation)
- [ ] Integration tests for MainActivity UI pass (section rendering, validation, interactions)
- [ ] `make lint` passes with no errors or warnings
- [ ] `make build` succeeds with no errors or warnings
- [ ] `make test-unit` passes

### Commit Strategy

| # | Message | Files |
|---|---------|-------|
| 1 | `feat: add Material 3 theme with light and dark mode support` | Color.kt, Type.kt, Theme.kt |
| 2 | `feat: add MainViewModel with settings state management` | MainViewModel.kt |
| 3 | `feat: add Compose UI components for server control` | ServerStatusCard.kt, ConfigurationSection.kt, ConnectionInfoCard.kt, PermissionsSection.kt |
| 4 | `feat: add server logs viewer data model and UI component` | ServerLogEntry.kt, ServerLogsSection.kt, MainViewModel.kt (update) |
| 5 | `feat: add HomeScreen and update MainActivity with Compose UI` | HomeScreen.kt, MainActivity.kt, strings.xml |
| 6 | `test: add unit tests for MainViewModel` | MainViewModelTest.kt |
| 7 | `test: add integration tests for MainActivity UI` | MainActivityTest.kt |

---

### Task 3.1: Create Material Design 3 Theme

**Description**: Define the application's visual theme: color palette (light and dark), typography, and the theme composable that ties them together with dynamic color support.

**Acceptance Criteria**:
- [ ] Color.kt defines both `lightColorScheme()` and `darkColorScheme()` with a tech/modern blue-purple palette
- [ ] Type.kt defines Material 3 Typography with system default fonts
- [ ] Theme.kt defines `AndroidRemoteControlMcpTheme` composable that:
  - Supports dark mode via `isSystemInDarkTheme()`
  - Uses dynamic colors (Material You) on Android 12+ (API 31+)
  - Falls back to custom color schemes on older devices
  - Applies MaterialTheme with colors, typography, and default shapes
- [ ] All three files compile without errors
- [ ] No lint warnings

**Tests**: No dedicated tests for theme files. Visual verification via `@Preview` composables in later tasks. Build and lint verification at user story level.

#### Action 3.1.1: Create `Color.kt`

**What**: Define the Material 3 color palette with light and dark color schemes using a modern tech blue-purple palette.

**Context**: Material 3 color schemes are created using `lightColorScheme()` and `darkColorScheme()` factory functions. Each scheme needs primary, secondary, tertiary, error, surface, and background colors with their "on" counterparts. The palette should feel modern, techy, and professional. Colors are used by `MaterialTheme` in `Theme.kt`.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/theme/Color.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/theme/Color.kt
@@ -0,0 +1,73 @@
+package com.danielealbano.androidremotecontrolmcp.ui.theme
+
+import androidx.compose.material3.darkColorScheme
+import androidx.compose.material3.lightColorScheme
+import androidx.compose.ui.graphics.Color
+
+// Primary: Modern blue-purple
+val PrimaryLight = Color(0xFF4A5FE0)
+val OnPrimaryLight = Color(0xFFFFFFFF)
+val PrimaryContainerLight = Color(0xFFDEE0FF)
+val OnPrimaryContainerLight = Color(0xFF00105C)
+
+// Secondary: Teal accent
+val SecondaryLight = Color(0xFF5B5D72)
+val OnSecondaryLight = Color(0xFFFFFFFF)
+val SecondaryContainerLight = Color(0xFFE0E0F9)
+val OnSecondaryContainerLight = Color(0xFF181A2C)
+
+// Tertiary: Soft violet
+val TertiaryLight = Color(0xFF77536D)
+val OnTertiaryLight = Color(0xFFFFFFFF)
+val TertiaryContainerLight = Color(0xFFFFD7F1)
+val OnTertiaryContainerLight = Color(0xFF2D1228)
+
+// Error
+val ErrorLight = Color(0xFFBA1A1A)
+val OnErrorLight = Color(0xFFFFFFFF)
+val ErrorContainerLight = Color(0xFFFFDAD6)
+val OnErrorContainerLight = Color(0xFF410002)
+
+// Surface and background
+val SurfaceLight = Color(0xFFFBF8FF)
+val OnSurfaceLight = Color(0xFF1B1B21)
+val SurfaceVariantLight = Color(0xFFE3E1EC)
+val OnSurfaceVariantLight = Color(0xFF46464F)
+val OutlineLight = Color(0xFF767680)
+val OutlineVariantLight = Color(0xFFC7C5D0)
+
+// Dark theme
+val PrimaryDark = Color(0xFFBAC3FF)
+val OnPrimaryDark = Color(0xFF0F2391)
+val PrimaryContainerDark = Color(0xFF2D43C7)
+val OnPrimaryContainerDark = Color(0xFFDEE0FF)
+
+val SecondaryDark = Color(0xFFC4C4DD)
+val OnSecondaryDark = Color(0xFF2D2F42)
+val SecondaryContainerDark = Color(0xFF434559)
+val OnSecondaryContainerDark = Color(0xFFE0E0F9)
+
+val TertiaryDark = Color(0xFFE5BAD8)
+val OnTertiaryDark = Color(0xFF44263E)
+val TertiaryContainerDark = Color(0xFF5D3C55)
+val OnTertiaryContainerDark = Color(0xFFFFD7F1)
+
+val ErrorDark = Color(0xFFFFB4AB)
+val OnErrorDark = Color(0xFF690005)
+val ErrorContainerDark = Color(0xFF93000A)
+val OnErrorContainerDark = Color(0xFFFFDAD6)
+
+val SurfaceDark = Color(0xFF131318)
+val OnSurfaceDark = Color(0xFFE4E1E9)
+val SurfaceVariantDark = Color(0xFF46464F)
+val OnSurfaceVariantDark = Color(0xFFC7C5D0)
+val OutlineDark = Color(0xFF90909A)
+val OutlineVariantDark = Color(0xFF46464F)
+
+val LightColorScheme = lightColorScheme(
+    primary = PrimaryLight, onPrimary = OnPrimaryLight,
+    primaryContainer = PrimaryContainerLight, onPrimaryContainer = OnPrimaryContainerLight,
+    secondary = SecondaryLight, onSecondary = OnSecondaryLight,
+    secondaryContainer = SecondaryContainerLight, onSecondaryContainer = OnSecondaryContainerLight,
+    tertiary = TertiaryLight, onTertiary = OnTertiaryLight,
+    tertiaryContainer = TertiaryContainerLight, onTertiaryContainer = OnTertiaryContainerLight,
+    error = ErrorLight, onError = OnErrorLight,
+    errorContainer = ErrorContainerLight, onErrorContainer = OnErrorContainerLight,
+    surface = SurfaceLight, onSurface = OnSurfaceLight,
+    surfaceVariant = SurfaceVariantLight, onSurfaceVariant = OnSurfaceVariantLight,
+    outline = OutlineLight, outlineVariant = OutlineVariantLight,
+)
+
+val DarkColorScheme = darkColorScheme(
+    primary = PrimaryDark, onPrimary = OnPrimaryDark,
+    primaryContainer = PrimaryContainerDark, onPrimaryContainer = OnPrimaryContainerDark,
+    secondary = SecondaryDark, onSecondary = OnSecondaryDark,
+    secondaryContainer = SecondaryContainerDark, onSecondaryContainer = OnSecondaryContainerDark,
+    tertiary = TertiaryDark, onTertiary = OnTertiaryDark,
+    tertiaryContainer = TertiaryContainerDark, onTertiaryContainer = OnTertiaryContainerDark,
+    error = ErrorDark, onError = OnErrorDark,
+    errorContainer = ErrorContainerDark, onErrorContainer = OnErrorContainerDark,
+    surface = SurfaceDark, onSurface = OnSurfaceDark,
+    surfaceVariant = SurfaceVariantDark, onSurfaceVariant = OnSurfaceVariantDark,
+    outline = OutlineDark, outlineVariant = OutlineVariantDark,
+)
```

---

#### Action 3.1.2: Create `Type.kt`

**What**: Define Material 3 Typography using system default fonts.

**Context**: Material 3 Typography provides a type scale with display, headline, title, body, and label sizes. We use the default system fonts (Roboto on most Android devices) as specified in the plan scope. The Typography object is consumed by `MaterialTheme` in `Theme.kt`.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/theme/Type.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/theme/Type.kt
@@ -0,0 +1,42 @@
+package com.danielealbano.androidremotecontrolmcp.ui.theme
+
+import androidx.compose.material3.Typography
+import androidx.compose.ui.text.TextStyle
+import androidx.compose.ui.text.font.FontFamily
+import androidx.compose.ui.text.font.FontWeight
+import androidx.compose.ui.unit.sp
+
+val AppTypography = Typography(
+    displayLarge = TextStyle(
+        fontFamily = FontFamily.Default,
+        fontWeight = FontWeight.Normal,
+        fontSize = 57.sp,
+        lineHeight = 64.sp,
+        letterSpacing = (-0.25).sp,
+    ),
+    headlineMedium = TextStyle(
+        fontFamily = FontFamily.Default,
+        fontWeight = FontWeight.Normal,
+        fontSize = 28.sp,
+        lineHeight = 36.sp,
+    ),
+    titleLarge = TextStyle(
+        fontFamily = FontFamily.Default,
+        fontWeight = FontWeight.Medium,
+        fontSize = 22.sp,
+        lineHeight = 28.sp,
+    ),
+    bodyLarge = TextStyle(
+        fontFamily = FontFamily.Default,
+        fontWeight = FontWeight.Normal,
+        fontSize = 16.sp,
+        lineHeight = 24.sp,
+        letterSpacing = 0.5.sp,
+    ),
+    labelSmall = TextStyle(
+        fontFamily = FontFamily.Default,
+        fontWeight = FontWeight.Medium,
+        fontSize = 11.sp,
+        lineHeight = 16.sp,
+        letterSpacing = 0.5.sp,
+    ),
+)
```

---

#### Action 3.1.3: Create `Theme.kt`

**What**: Create the `AndroidRemoteControlMcpTheme` composable that applies the Material 3 theme with dynamic color support.

**Context**: The theme composable is the top-level wrapper for all UI content. It checks for dynamic color availability (Android 12+ / API 31+) and falls back to the custom color schemes defined in `Color.kt`. It uses `isSystemInDarkTheme()` to follow the system-wide dark mode setting. This composable is called from `MainActivity.setContent {}`.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/theme/Theme.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/theme/Theme.kt
@@ -0,0 +1,37 @@
+package com.danielealbano.androidremotecontrolmcp.ui.theme
+
+import android.os.Build
+import androidx.compose.foundation.isSystemInDarkTheme
+import androidx.compose.material3.MaterialTheme
+import androidx.compose.material3.dynamicDarkColorScheme
+import androidx.compose.material3.dynamicLightColorScheme
+import androidx.compose.runtime.Composable
+import androidx.compose.ui.platform.LocalContext
+
+@Composable
+fun AndroidRemoteControlMcpTheme(
+    darkTheme: Boolean = isSystemInDarkTheme(),
+    dynamicColor: Boolean = true,
+    content: @Composable () -> Unit,
+) {
+    val colorScheme = when {
+        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {
+            val context = LocalContext.current
+            if (darkTheme) {
+                dynamicDarkColorScheme(context)
+            } else {
+                dynamicLightColorScheme(context)
+            }
+        }
+        darkTheme -> DarkColorScheme
+        else -> LightColorScheme
+    }
+
+    MaterialTheme(
+        colorScheme = colorScheme,
+        typography = AppTypography,
+        content = content,
+    )
+}
```

---

### Task 3.2: Create MainViewModel

**Description**: Create the ViewModel that manages all UI state for the HomeScreen. It reads initial configuration from SettingsRepository, exposes state via StateFlows, validates user input, and provides methods to update settings.

**Acceptance Criteria**:
- [ ] MainViewModel is annotated with `@HiltViewModel` and injects `SettingsRepository`
- [ ] Exposes `serverConfig: StateFlow<ServerConfig>` from repository
- [ ] Exposes `serverStatus: StateFlow<ServerStatus>` (initially `Stopped`, stub for Plan 6 wiring)
- [ ] Exposes `portInput: StateFlow<String>` for the port text field
- [ ] Exposes `portError: StateFlow<String?>` for port validation error
- [ ] Exposes `hostnameInput: StateFlow<String>` for the hostname text field
- [ ] Exposes `hostnameError: StateFlow<String?>` for hostname validation error
- [ ] Exposes `isAccessibilityEnabled: StateFlow<Boolean>` for accessibility permission status
- [ ] `updatePort(portString)` validates range 1-65535 and persists via repository
- [ ] `updateBindingAddress(address)` persists via repository
- [ ] `generateNewBearerToken()` generates new UUID and persists via repository
- [ ] `updateAutoStartOnBoot(enabled)` persists via repository
- [ ] `updateCertificateSource(source)` persists via repository
- [ ] `updateCertificateHostname(hostname)` validates non-empty and persists via repository
- [ ] `startServer()` and `stopServer()` are no-op stubs that log a message
- [ ] `copyToClipboard(context, text)` copies text to system clipboard
- [ ] `refreshPermissionStatus(context)` checks accessibility service enabled state
- [ ] Init block loads initial config from repository and populates portInput and hostnameInput
- [ ] All StateFlows use appropriate backing `MutableStateFlow` with underscore prefix

**Tests**: Unit tests are written in Task 3.6. Build and lint verification at user story level.

#### Action 3.2.1: Create `MainViewModel.kt`

**What**: Create the ViewModel with settings state management, input validation, and action methods.

**Context**: The ViewModel follows the MVVM pattern and is the single source of truth for the UI state. It uses `viewModelScope` for coroutine operations and `Dispatchers.IO` for repository calls. The `serverConfig` flow is collected from the repository. Port and hostname inputs are stored as separate text field state to support real-time validation with error display. The `startServer`/`stopServer` stubs will be wired to `McpServerService` in Plan 6. The `copyToClipboard` method uses `ClipboardManager` from Android framework. The `refreshPermissionStatus` method uses the `PermissionUtils` from Plan 2.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModel.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModel.kt
@@ -0,0 +1,152 @@
+package com.danielealbano.androidremotecontrolmcp.ui.viewmodels
+
+import android.content.ClipData
+import android.content.ClipboardManager
+import android.content.Context
+import android.util.Log
+import androidx.lifecycle.ViewModel
+import androidx.lifecycle.viewModelScope
+import com.danielealbano.androidremotecontrolmcp.data.model.BindingAddress
+import com.danielealbano.androidremotecontrolmcp.data.model.CertificateSource
+import com.danielealbano.androidremotecontrolmcp.data.model.ServerConfig
+import com.danielealbano.androidremotecontrolmcp.data.model.ServerStatus
+import com.danielealbano.androidremotecontrolmcp.data.repository.SettingsRepository
+import com.danielealbano.androidremotecontrolmcp.services.accessibility.McpAccessibilityService
+import com.danielealbano.androidremotecontrolmcp.utils.PermissionUtils
+import dagger.hilt.android.lifecycle.HiltViewModel
+import kotlinx.coroutines.Dispatchers
+import kotlinx.coroutines.flow.MutableStateFlow
+import kotlinx.coroutines.flow.StateFlow
+import kotlinx.coroutines.flow.asStateFlow
+import kotlinx.coroutines.launch
+import javax.inject.Inject
+
+@HiltViewModel
+class MainViewModel @Inject constructor(
+    private val settingsRepository: SettingsRepository,
+) : ViewModel() {
+
+    private val _serverConfig = MutableStateFlow(ServerConfig())
+    val serverConfig: StateFlow<ServerConfig> = _serverConfig.asStateFlow()
+
+    private val _serverStatus = MutableStateFlow<ServerStatus>(ServerStatus.Stopped)
+    val serverStatus: StateFlow<ServerStatus> = _serverStatus.asStateFlow()
+
+    private val _portInput = MutableStateFlow("")
+    val portInput: StateFlow<String> = _portInput.asStateFlow()
+
+    private val _portError = MutableStateFlow<String?>(null)
+    val portError: StateFlow<String?> = _portError.asStateFlow()
+
+    private val _hostnameInput = MutableStateFlow("")
+    val hostnameInput: StateFlow<String> = _hostnameInput.asStateFlow()
+
+    private val _hostnameError = MutableStateFlow<String?>(null)
+    val hostnameError: StateFlow<String?> = _hostnameError.asStateFlow()
+
+    private val _isAccessibilityEnabled = MutableStateFlow(false)
+    val isAccessibilityEnabled: StateFlow<Boolean> = _isAccessibilityEnabled.asStateFlow()
+
+    init {
+        viewModelScope.launch(Dispatchers.IO) {
+            settingsRepository.serverConfig.collect { config ->
+                _serverConfig.value = config
+                _portInput.value = config.port.toString()
+                _hostnameInput.value = config.certificateHostname
+            }
+        }
+    }
+
+    fun updatePort(portString: String) {
+        _portInput.value = portString
+
+        if (portString.isBlank()) {
+            _portError.value = "Port is required"
+            return
+        }
+
+        val port = portString.toIntOrNull()
+        if (port == null) {
+            _portError.value = "Port must be a number"
+            return
+        }
+
+        if (port < MIN_PORT || port > MAX_PORT) {
+            _portError.value = "Port must be between $MIN_PORT and $MAX_PORT"
+            return
+        }
+
+        _portError.value = null
+        viewModelScope.launch(Dispatchers.IO) {
+            settingsRepository.updatePort(port)
+        }
+    }
+
+    fun updateBindingAddress(address: BindingAddress) {
+        viewModelScope.launch(Dispatchers.IO) {
+            settingsRepository.updateBindingAddress(address)
+        }
+    }
+
+    fun generateNewBearerToken() {
+        viewModelScope.launch(Dispatchers.IO) {
+            settingsRepository.generateNewBearerToken()
+        }
+    }
+
+    fun updateAutoStartOnBoot(enabled: Boolean) {
+        viewModelScope.launch(Dispatchers.IO) {
+            settingsRepository.updateAutoStartOnBoot(enabled)
+        }
+    }
+
+    fun updateCertificateSource(source: CertificateSource) {
+        viewModelScope.launch(Dispatchers.IO) {
+            settingsRepository.updateCertificateSource(source)
+        }
+    }
+
+    fun updateCertificateHostname(hostname: String) {
+        _hostnameInput.value = hostname
+
+        if (hostname.isBlank()) {
+            _hostnameError.value = "Hostname is required"
+            return
+        }
+
+        if (!HOSTNAME_PATTERN.matches(hostname)) {
+            _hostnameError.value = "Invalid hostname format"
+            return
+        }
+
+        _hostnameError.value = null
+        viewModelScope.launch(Dispatchers.IO) {
+            settingsRepository.updateCertificateHostname(hostname)
+        }
+    }
+
+    fun startServer() {
+        Log.i(TAG, "startServer called (stub, will be wired in Plan 6)")
+    }
+
+    fun stopServer() {
+        Log.i(TAG, "stopServer called (stub, will be wired in Plan 6)")
+    }
+
+    fun copyToClipboard(context: Context, text: String) {
+        val clipboard = context.getSystemService(Context.CLIPBOARD_SERVICE) as ClipboardManager
+        val clip = ClipData.newPlainText(CLIPBOARD_LABEL, text)
+        clipboard.setPrimaryClip(clip)
+    }
+
+    fun refreshPermissionStatus(context: Context) {
+        _isAccessibilityEnabled.value = PermissionUtils.isAccessibilityServiceEnabled(context, McpAccessibilityService::class.java)
+    }
+
+    companion object {
+        private const val TAG = "MCP:MainViewModel"
+        private const val MIN_PORT = 1
+        private const val MAX_PORT = 65535
+        private const val CLIPBOARD_LABEL = "MCP Remote Control"
+        private val HOSTNAME_PATTERN = Regex(
+            "^[a-zA-Z0-9]([a-zA-Z0-9\\-]*[a-zA-Z0-9])?(\\.[a-zA-Z0-9]([a-zA-Z0-9\\-]*[a-zA-Z0-9])?)*$",
+        )
+    }
+}
```

> **Implementation Note**: The `SettingsRepository.serverConfig` is assumed to be a `Flow<ServerConfig>` as defined in Plan 2. The init block collects this flow on `Dispatchers.IO` to load the initial configuration and keep the UI in sync with any repository-level changes. The port and hostname input fields update both the local text state (for the TextField) and the repository (after validation). The `PermissionUtils.isAccessibilityServiceEnabled(context, serviceClass)` method is defined in Plan 2 with two parameters; here we pass `McpAccessibilityService::class.java` as the service class.

> **Implementation Note on hostname validation**: The regex validates standard hostnames (RFC 952/1123): alphanumeric characters and hyphens, with dots as segment separators. Examples of valid hostnames: `android-mcp.local`, `my-device`, `192.168.1.1` (though IP addresses are not technically hostnames, the pattern accepts them for convenience).

> **Implementation Note — Validation consolidation**: This regex is a simplified version for immediate UI feedback. The authoritative hostname validation is in `SettingsRepositoryImpl` (Plan 2) which enforces RFC-compliant length limits. At implementation time, consider delegating validation to the repository to avoid divergence.

---

### Task 3.3: Create Compose UI Components

**Description**: Create the four main UI components: ServerStatusCard, ConfigurationSection, ConnectionInfoCard, and PermissionsSection. Each component uses state hoisting (receives state as parameters) and supports both light and dark themes.

**Acceptance Criteria**:
- [ ] ServerStatusCard displays status with colored dot indicator (green=Running, red=Stopped, yellow=Starting/Stopping, orange=Error)
- [ ] ServerStatusCard has Start/Stop toggle button (FilledTonalButton)
- [ ] ConfigurationSection has SegmentedButton or RadioButtons for binding address (LOCALHOST vs NETWORK)
- [ ] ConfigurationSection shows AlertDialog with exact PROJECT.md security warning when NETWORK is selected
- [ ] ConfigurationSection has OutlinedTextField for port with validation error display
- [ ] ConfigurationSection has read-only OutlinedTextField for bearer token with Copy and Regenerate buttons
- [ ] ConfigurationSection has Switch for auto-start
- [ ] ConfigurationSection has RadioButtons for certificate source (Auto-generated vs Custom) and hostname input for auto-generated
- [ ] ConfigurationSection disables all inputs when `isServerRunning` is true
- [ ] ConnectionInfoCard displays IP, port, server URL (HTTPS or HTTP depending on configuration), token (masked with show/hide toggle), and Copy-all button
- [ ] PermissionsSection shows accessibility and notification permission status with enable buttons
- [ ] All interactive elements have minimum 48dp touch targets
- [ ] All icons have contentDescription
- [ ] `@Preview` annotations exist for key composables

**Tests**: Integration tests are written in Task 3.7. Build and lint verification at user story level.

#### Action 3.3.1: Create `ServerStatusCard.kt`

**What**: Create the server status display card with a status indicator dot, status text, and Start/Stop toggle button.

**Context**: The card is a Material 3 `ElevatedCard` that shows the current server status. The colored dot uses `Canvas` with different colors per status. The button label changes based on status (Start when Stopped, Stop when Running). The card uses state hoisting -- it receives all state as parameters and calls lambda callbacks for actions.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ServerStatusCard.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ServerStatusCard.kt
@@ -0,0 +1,123 @@
+package com.danielealbano.androidremotecontrolmcp.ui.components
+
+import androidx.compose.animation.animateColorAsState
+import androidx.compose.animation.core.tween
+import androidx.compose.foundation.Canvas
+import androidx.compose.foundation.layout.Arrangement
+import androidx.compose.foundation.layout.Column
+import androidx.compose.foundation.layout.Row
+import androidx.compose.foundation.layout.Spacer
+import androidx.compose.foundation.layout.fillMaxWidth
+import androidx.compose.foundation.layout.padding
+import androidx.compose.foundation.layout.size
+import androidx.compose.foundation.layout.width
+import androidx.compose.material3.ElevatedCard
+import androidx.compose.material3.FilledTonalButton
+import androidx.compose.material3.MaterialTheme
+import androidx.compose.material3.Text
+import androidx.compose.runtime.Composable
+import androidx.compose.runtime.getValue
+import androidx.compose.ui.Alignment
+import androidx.compose.ui.Modifier
+import androidx.compose.ui.graphics.Color
+import androidx.compose.ui.res.stringResource
+import androidx.compose.ui.semantics.contentDescription
+import androidx.compose.ui.semantics.semantics
+import androidx.compose.ui.tooling.preview.Preview
+import androidx.compose.ui.unit.dp
+import com.danielealbano.androidremotecontrolmcp.R
+import com.danielealbano.androidremotecontrolmcp.data.model.ServerStatus
+import com.danielealbano.androidremotecontrolmcp.ui.theme.AndroidRemoteControlMcpTheme
+
+private const val STATUS_DOT_SIZE_DP = 12
+private const val ANIMATION_DURATION_MS = 300
+
+@Composable
+fun ServerStatusCard(
+    status: ServerStatus,
+    onStartClick: () -> Unit,
+    onStopClick: () -> Unit,
+    modifier: Modifier = Modifier,
+) {
+    val statusColor by animateColorAsState(
+        targetValue = statusToColor(status),
+        animationSpec = tween(durationMillis = ANIMATION_DURATION_MS),
+        label = "statusColor",
+    )
+
+    val statusText = statusToText(status)
+    val isRunning = status is ServerStatus.Running
+    val canToggle = status is ServerStatus.Running || status is ServerStatus.Stopped
+
+    ElevatedCard(
+        modifier = modifier.fillMaxWidth(),
+    ) {
+        Column(
+            modifier = Modifier.padding(16.dp),
+        ) {
+            Text(
+                text = stringResource(R.string.server_status_title),
+                style = MaterialTheme.typography.titleLarge,
+            )
+
+            Row(
+                modifier = Modifier
+                    .fillMaxWidth()
+                    .padding(top = 12.dp),
+                horizontalArrangement = Arrangement.SpaceBetween,
+                verticalAlignment = Alignment.CenterVertically,
+            ) {
+                Row(
+                    verticalAlignment = Alignment.CenterVertically,
+                ) {
+                    Canvas(
+                        modifier = Modifier
+                            .size(STATUS_DOT_SIZE_DP.dp)
+                            .semantics {
+                                contentDescription = "Server status indicator: $statusText"
+                            },
+                    ) {
+                        drawCircle(color = statusColor)
+                    }
+                    Spacer(modifier = Modifier.width(8.dp))
+                    Text(
+                        text = statusText,
+                        style = MaterialTheme.typography.bodyLarge,
+                    )
+                }
+
+                FilledTonalButton(
+                    onClick = if (isRunning) onStopClick else onStartClick,
+                    enabled = canToggle,
+                ) {
+                    Text(
+                        text = if (isRunning) {
+                            stringResource(R.string.server_action_stop)
+                        } else {
+                            stringResource(R.string.server_action_start)
+                        },
+                    )
+                }
+            }
+        }
+    }
+}
+
+@Composable
+private fun statusToText(status: ServerStatus): String = when (status) {
+    is ServerStatus.Running -> stringResource(R.string.server_status_running)
+    is ServerStatus.Stopped -> stringResource(R.string.server_status_stopped)
+    is ServerStatus.Starting -> stringResource(R.string.server_status_starting)
+    is ServerStatus.Stopping -> stringResource(R.string.server_status_stopping)
+    is ServerStatus.Error -> stringResource(R.string.server_status_error, status.message)
+}
+
+private fun statusToColor(status: ServerStatus): Color = when (status) {
+    is ServerStatus.Running -> Color(0xFF4CAF50)
+    is ServerStatus.Stopped -> Color(0xFFF44336)
+    is ServerStatus.Starting -> Color(0xFFFFC107)
+    is ServerStatus.Stopping -> Color(0xFFFFC107)
+    is ServerStatus.Error -> Color(0xFFFF9800)
+}
+
+@Preview(showBackground = true)
+@Composable
+private fun ServerStatusCardStoppedPreview() {
+    AndroidRemoteControlMcpTheme {
+        ServerStatusCard(
+            status = ServerStatus.Stopped,
+            onStartClick = {},
+            onStopClick = {},
+        )
+    }
+}
```

> **Implementation Note on ServerStatus**: The `ServerStatus` sealed class is assumed from Plan 2 to have subclasses: `Running`, `Stopped`, `Starting`, `Stopping`, and `Error(message: String)`. The `statusToText` function is marked `@Composable` because it uses `stringResource()`. The `statusToColor` function is not composable because it only returns static `Color` values. The `Error` status uses `stringResource(R.string.server_status_error, status.message)` which is a format string with a placeholder.

---

#### Action 3.3.2: Create `ConfigurationSection.kt`

**What**: Create the configuration settings form with binding address selector, port input, bearer token display, auto-start toggle, and HTTPS certificate settings. Includes the security warning dialog for 0.0.0.0 binding.

**Context**: This is the largest UI component. It groups all server settings into a visually distinct section. All inputs are disabled when `isServerRunning` is true to prevent configuration changes while the server is active. The binding address uses `SingleChoiceSegmentedButtonRow` from Material 3. The security warning dialog text must match PROJECT.md exactly. Bearer token is displayed in a read-only `OutlinedTextField` with copy and regenerate icon buttons. Certificate source uses `RadioButton` with labels.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ConfigurationSection.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ConfigurationSection.kt
@@ -0,0 +1,342 @@
+package com.danielealbano.androidremotecontrolmcp.ui.components
+
+import androidx.compose.foundation.layout.Column
+import androidx.compose.foundation.layout.Row
+import androidx.compose.foundation.layout.Spacer
+import androidx.compose.foundation.layout.fillMaxWidth
+import androidx.compose.foundation.layout.height
+import androidx.compose.foundation.layout.padding
+import androidx.compose.foundation.layout.width
+import androidx.compose.foundation.selection.selectable
+import androidx.compose.foundation.selection.selectableGroup
+import androidx.compose.foundation.text.KeyboardOptions
+import androidx.compose.material.icons.Icons
+import androidx.compose.material.icons.filled.ContentCopy
+import androidx.compose.material.icons.filled.Refresh
+import androidx.compose.material.icons.filled.Visibility
+import androidx.compose.material.icons.filled.VisibilityOff
+import androidx.compose.material3.AlertDialog
+import androidx.compose.material3.ElevatedCard
+import androidx.compose.material3.Icon
+import androidx.compose.material3.IconButton
+import androidx.compose.material3.MaterialTheme
+import androidx.compose.material3.OutlinedTextField
+import androidx.compose.material3.RadioButton
+import androidx.compose.material3.SegmentedButton
+import androidx.compose.material3.SegmentedButtonDefaults
+import androidx.compose.material3.SingleChoiceSegmentedButtonRow
+import androidx.compose.material3.Switch
+import androidx.compose.material3.Text
+import androidx.compose.material3.TextButton
+import androidx.compose.runtime.Composable
+import androidx.compose.runtime.getValue
+import androidx.compose.runtime.mutableStateOf
+import androidx.compose.runtime.remember
+import androidx.compose.runtime.setValue
+import androidx.compose.ui.Alignment
+import androidx.compose.ui.Modifier
+import androidx.compose.ui.res.stringResource
+import androidx.compose.ui.semantics.Role
+import androidx.compose.ui.semantics.contentDescription
+import androidx.compose.ui.semantics.semantics
+import androidx.compose.ui.text.input.KeyboardType
+import androidx.compose.ui.text.input.PasswordVisualTransformation
+import androidx.compose.ui.text.input.VisualTransformation
+import androidx.compose.ui.tooling.preview.Preview
+import androidx.compose.ui.unit.dp
+import com.danielealbano.androidremotecontrolmcp.R
+import com.danielealbano.androidremotecontrolmcp.data.model.BindingAddress
+import com.danielealbano.androidremotecontrolmcp.data.model.CertificateSource
+import com.danielealbano.androidremotecontrolmcp.ui.theme.AndroidRemoteControlMcpTheme
+
+@Composable
+fun ConfigurationSection(
+    bindingAddress: BindingAddress,
+    portInput: String,
+    portError: String?,
+    bearerToken: String,
+    autoStartEnabled: Boolean,
+    certificateSource: CertificateSource,
+    hostnameInput: String,
+    hostnameError: String?,
+    isServerRunning: Boolean,
+    onBindingAddressChange: (BindingAddress) -> Unit,
+    onPortChange: (String) -> Unit,
+    onRegenerateToken: () -> Unit,
+    onCopyToken: () -> Unit,
+    onAutoStartChange: (Boolean) -> Unit,
+    onCertificateSourceChange: (CertificateSource) -> Unit,
+    onHostnameChange: (String) -> Unit,
+    modifier: Modifier = Modifier,
+) {
+    var showNetworkWarningDialog by remember { mutableStateOf(false) }
+    var showBearerToken by remember { mutableStateOf(false) }
+
+    if (showNetworkWarningDialog) {
+        NetworkSecurityWarningDialog(
+            onConfirm = {
+                showNetworkWarningDialog = false
+                onBindingAddressChange(BindingAddress.NETWORK)
+            },
+            onDismiss = {
+                showNetworkWarningDialog = false
+            },
+        )
+    }
+
+    ElevatedCard(
+        modifier = modifier.fillMaxWidth(),
+    ) {
+        Column(
+            modifier = Modifier.padding(16.dp),
+        ) {
+            Text(
+                text = stringResource(R.string.configuration_title),
+                style = MaterialTheme.typography.titleLarge,
+            )
+
+            Spacer(modifier = Modifier.height(16.dp))
+
+            // Binding Address Selector
+            Text(
+                text = stringResource(R.string.config_binding_address_label),
+                style = MaterialTheme.typography.labelLarge,
+            )
+            Spacer(modifier = Modifier.height(4.dp))
+            BindingAddressSelector(
+                selected = bindingAddress,
+                enabled = !isServerRunning,
+                onSelect = { address ->
+                    if (address == BindingAddress.NETWORK) {
+                        showNetworkWarningDialog = true
+                    } else {
+                        onBindingAddressChange(address)
+                    }
+                },
+            )
+
+            Spacer(modifier = Modifier.height(16.dp))
+
+            // Port Input
+            OutlinedTextField(
+                value = portInput,
+                onValueChange = onPortChange,
+                label = { Text(stringResource(R.string.config_port_label)) },
+                isError = portError != null,
+                supportingText = portError?.let { { Text(it) } },
+                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number),
+                singleLine = true,
+                enabled = !isServerRunning,
+                modifier = Modifier.fillMaxWidth(),
+            )
+
+            Spacer(modifier = Modifier.height(16.dp))
+
+            // Bearer Token Display
+            Text(
+                text = stringResource(R.string.config_bearer_token_label),
+                style = MaterialTheme.typography.labelLarge,
+            )
+            Spacer(modifier = Modifier.height(4.dp))
+            OutlinedTextField(
+                value = bearerToken,
+                onValueChange = {},
+                readOnly = true,
+                singleLine = true,
+                visualTransformation = if (showBearerToken) {
+                    VisualTransformation.None
+                } else {
+                    PasswordVisualTransformation()
+                },
+                trailingIcon = {
+                    Row {
+                        IconButton(
+                            onClick = { showBearerToken = !showBearerToken },
+                        ) {
+                            Icon(
+                                imageVector = if (showBearerToken) {
+                                    Icons.Default.VisibilityOff
+                                } else {
+                                    Icons.Default.Visibility
+                                },
+                                contentDescription = if (showBearerToken) {
+                                    stringResource(R.string.config_token_hide)
+                                } else {
+                                    stringResource(R.string.config_token_show)
+                                },
+                            )
+                        }
+                        IconButton(
+                            onClick = onCopyToken,
+                            modifier = Modifier.semantics {
+                                contentDescription = "Copy bearer token"
+                            },
+                        ) {
+                            Icon(
+                                imageVector = Icons.Default.ContentCopy,
+                                contentDescription = stringResource(R.string.config_token_copy),
+                            )
+                        }
+                        IconButton(
+                            onClick = onRegenerateToken,
+                            enabled = !isServerRunning,
+                            modifier = Modifier.semantics {
+                                contentDescription = "Regenerate bearer token"
+                            },
+                        ) {
+                            Icon(
+                                imageVector = Icons.Default.Refresh,
+                                contentDescription = stringResource(R.string.config_token_regenerate),
+                            )
+                        }
+                    }
+                },
+                modifier = Modifier.fillMaxWidth(),
+            )
+
+            Spacer(modifier = Modifier.height(16.dp))
+
+            // Auto-Start Toggle
+            Row(
+                modifier = Modifier.fillMaxWidth(),
+                verticalAlignment = Alignment.CenterVertically,
+            ) {
+                Text(
+                    text = stringResource(R.string.config_auto_start_label),
+                    style = MaterialTheme.typography.bodyLarge,
+                    modifier = Modifier.weight(1f),
+                )
+                Switch(
+                    checked = autoStartEnabled,
+                    onCheckedChange = onAutoStartChange,
+                    enabled = !isServerRunning,
+                )
+            }
+
+            Spacer(modifier = Modifier.height(16.dp))
+
+            // HTTPS Toggle and Certificate Section
+
+> **CRITICAL — Missing HTTPS toggle**: The `ConfigurationSection` is missing an HTTPS enable/disable `Switch` composable. PROJECT.md line 69 requires "HTTPS toggle and certificate management." At implementation time: (1) add an `httpsEnabled: Boolean` parameter to `ConfigurationSection`, (2) add an `onHttpsEnabledChange: (Boolean) -> Unit` callback parameter, (3) add a `Switch` composable for the HTTPS toggle BEFORE the certificate source selector, (4) wrap the certificate source and hostname inputs in an `AnimatedVisibility(visible = httpsEnabled)` block so they only show when HTTPS is enabled, (5) add `updateHttpsEnabled(enabled: Boolean)` to `MainViewModel`, (6) pass `serverConfig.httpsEnabled` from `HomeScreen`. This also requires the `httpsEnabled` field to be added to `ServerConfig` (see Plan 2 NC1 note).
+
+            // HTTPS Certificate Section
+            Text(
+                text = stringResource(R.string.config_certificate_title),
+                style = MaterialTheme.typography.labelLarge,
+            )
+            Spacer(modifier = Modifier.height(4.dp))
+            CertificateSourceSelector(
+                selected = certificateSource,
+                enabled = !isServerRunning,
+                onSelect = onCertificateSourceChange,
+            )
+
+            if (certificateSource == CertificateSource.AUTO_GENERATED) {
+                Spacer(modifier = Modifier.height(8.dp))
+                OutlinedTextField(
+                    value = hostnameInput,
+                    onValueChange = onHostnameChange,
+                    label = { Text(stringResource(R.string.config_hostname_label)) },
+                    isError = hostnameError != null,
+                    supportingText = hostnameError?.let { { Text(it) } },
+                    singleLine = true,
+                    enabled = !isServerRunning,
+                    modifier = Modifier.fillMaxWidth(),
+                )
+            }
+        }
+    }
+}
+
+@Composable
+private fun BindingAddressSelector(
+    selected: BindingAddress,
+    enabled: Boolean,
+    onSelect: (BindingAddress) -> Unit,
+    modifier: Modifier = Modifier,
+) {
+    val options = BindingAddress.entries
+    SingleChoiceSegmentedButtonRow(
+        modifier = modifier.fillMaxWidth(),
+    ) {
+        options.forEachIndexed { index, address ->
+            SegmentedButton(
+                selected = address == selected,
+                onClick = { onSelect(address) },
+                shape = SegmentedButtonDefaults.itemShape(
+                    index = index,
+                    count = options.size,
+                ),
+                enabled = enabled,
+            ) {
+                Text(
+                    text = when (address) {
+                        BindingAddress.LOCALHOST -> stringResource(R.string.config_binding_localhost)
+                        BindingAddress.NETWORK -> stringResource(R.string.config_binding_network)
+                    },
+                )
+            }
+        }
+    }
+}
+
+@Composable
+private fun CertificateSourceSelector(
+    selected: CertificateSource,
+    enabled: Boolean,
+    onSelect: (CertificateSource) -> Unit,
+    modifier: Modifier = Modifier,
+) {
+    Column(
+        modifier = modifier.selectableGroup(),
+    ) {
+        CertificateSource.entries.forEach { source ->
+            Row(
+                modifier = Modifier
+                    .fillMaxWidth()
+                    .selectable(
+                        selected = source == selected,
+                        onClick = { onSelect(source) },
+                        role = Role.RadioButton,
+                        enabled = enabled,
+                    )
+                    .padding(vertical = 4.dp),
+                verticalAlignment = Alignment.CenterVertically,
+            ) {
+                RadioButton(
+                    selected = source == selected,
+                    onClick = null,
+                    enabled = enabled,
+                )
+                Spacer(modifier = Modifier.width(8.dp))
+                Text(
+                    text = when (source) {
+                        CertificateSource.AUTO_GENERATED ->
+                            stringResource(R.string.config_cert_auto_generated)
+                        CertificateSource.CUSTOM ->
+                            stringResource(R.string.config_cert_custom)
+                    },
+                    style = MaterialTheme.typography.bodyLarge,
+                )
+            }
+        }
+    }
+}
+
+@Composable
+private fun NetworkSecurityWarningDialog(
+    onConfirm: () -> Unit,
+    onDismiss: () -> Unit,
+) {
+    AlertDialog(
+        onDismissRequest = onDismiss,
+        title = {
+            Text(stringResource(R.string.network_warning_title))
+        },
+        text = {
+            Text(stringResource(R.string.network_warning_message))
+        },
+        confirmButton = {
+            TextButton(onClick = onConfirm) {
+                Text(stringResource(R.string.network_warning_confirm))
+            }
+        },
+        dismissButton = {
+            TextButton(onClick = onDismiss) {
+                Text(stringResource(R.string.network_warning_cancel))
+            }
+        },
+    )
+}
+
+@Preview(showBackground = true)
+@Composable
+private fun ConfigurationSectionPreview() {
+    AndroidRemoteControlMcpTheme {
+        ConfigurationSection(
+            bindingAddress = BindingAddress.LOCALHOST,
+            portInput = "8080",
+            portError = null,
+            bearerToken = "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
+            autoStartEnabled = false,
+            certificateSource = CertificateSource.AUTO_GENERATED,
+            hostnameInput = "android-mcp.local",
+            hostnameError = null,
+            isServerRunning = false,
+            onBindingAddressChange = {},
+            onPortChange = {},
+            onRegenerateToken = {},
+            onCopyToken = {},
+            onAutoStartChange = {},
+            onCertificateSourceChange = {},
+            onHostnameChange = {},
+        )
+    }
+}
```

> **Implementation Note on BindingAddress and CertificateSource**: These are assumed to be `enum class` types from Plan 2 with entries `LOCALHOST`/`NETWORK` and `AUTO_GENERATED`/`CUSTOM` respectively. The `.entries` property (Kotlin 1.9+) is used to iterate over enum values.

> **Implementation Note on Security Warning Dialog**: The dialog text uses string resources `R.string.network_warning_title` and `R.string.network_warning_message`. The message content in `strings.xml` (Action 3.4.2) matches the exact text from PROJECT.md Security section.

---

#### Action 3.3.3: Create `ConnectionInfoCard.kt`

**What**: Create the connection information card that shows IP, port, server URL (HTTPS or HTTP depending on configuration; HTTPS is optional, disabled by default), and bearer token with copy functionality.

**Context**: This card provides the information needed by an MCP client to connect to the server. The bearer token is masked by default with a show/hide toggle. A "Copy All" button copies a formatted connection string to the clipboard. The displayed IP address comes from `ServerConfig` (which reflects the actual binding address or the device's network IP).

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ConnectionInfoCard.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ConnectionInfoCard.kt
@@ -0,0 +1,128 @@
+package com.danielealbano.androidremotecontrolmcp.ui.components
+
+import androidx.compose.foundation.layout.Column
+import androidx.compose.foundation.layout.Row
+import androidx.compose.foundation.layout.Spacer
+import androidx.compose.foundation.layout.fillMaxWidth
+import androidx.compose.foundation.layout.height
+import androidx.compose.foundation.layout.padding
+import androidx.compose.material.icons.Icons
+import androidx.compose.material.icons.filled.ContentCopy
+import androidx.compose.material.icons.filled.Visibility
+import androidx.compose.material.icons.filled.VisibilityOff
+import androidx.compose.material3.ElevatedCard
+import androidx.compose.material3.Icon
+import androidx.compose.material3.IconButton
+import androidx.compose.material3.MaterialTheme
+import androidx.compose.material3.Text
+import androidx.compose.material3.TextButton
+import androidx.compose.runtime.Composable
+import androidx.compose.runtime.getValue
+import androidx.compose.runtime.mutableStateOf
+import androidx.compose.runtime.remember
+import androidx.compose.runtime.setValue
+import androidx.compose.ui.Alignment
+import androidx.compose.ui.Modifier
+import androidx.compose.ui.res.stringResource
+import androidx.compose.ui.tooling.preview.Preview
+import androidx.compose.ui.unit.dp
+import com.danielealbano.androidremotecontrolmcp.R
+import com.danielealbano.androidremotecontrolmcp.data.model.BindingAddress
+import com.danielealbano.androidremotecontrolmcp.ui.theme.AndroidRemoteControlMcpTheme
+
+private const val TOKEN_MASK = "********-****-****-****-************"
+
+@Composable
+fun ConnectionInfoCard(
+    bindingAddress: BindingAddress,
+    ipAddress: String,
+    port: Int,
+    httpsEnabled: Boolean,
+    bearerToken: String,
+    onCopyAll: (String) -> Unit,
+    modifier: Modifier = Modifier,
+) {
+    var showToken by remember { mutableStateOf(false) }
+
+    val displayAddress = when (bindingAddress) {
+        BindingAddress.LOCALHOST -> "127.0.0.1"
+        BindingAddress.NETWORK -> ipAddress
+    }
+    val scheme = if (httpsEnabled) "https" else "http"
+    val serverUrl = "$scheme://$displayAddress:$port"
+    val displayToken = if (showToken) bearerToken else TOKEN_MASK
+
+    ElevatedCard(
+        modifier = modifier.fillMaxWidth(),
+    ) {
+        Column(
+            modifier = Modifier.padding(16.dp),
+        ) {
+            Text(
+                text = stringResource(R.string.connection_info_title),
+                style = MaterialTheme.typography.titleLarge,
+            )
+
+            Spacer(modifier = Modifier.height(12.dp))
+
+            ConnectionInfoRow(
+                label = stringResource(R.string.connection_info_ip),
+                value = displayAddress,
+            )
+            ConnectionInfoRow(
+                label = stringResource(R.string.connection_info_port),
+                value = port.toString(),
+            )
+            ConnectionInfoRow(
+                label = stringResource(R.string.connection_info_url),
+                value = serverUrl,
+            )
+
+            Row(
+                verticalAlignment = Alignment.CenterVertically,
+            ) {
+                Text(
+                    text = "${stringResource(R.string.connection_info_token)}: ",
+                    style = MaterialTheme.typography.bodyMedium,
+                    color = MaterialTheme.colorScheme.onSurfaceVariant,
+                )
+                Text(
+                    text = displayToken,
+                    style = MaterialTheme.typography.bodyMedium,
+                    modifier = Modifier.weight(1f),
+                )
+                IconButton(onClick = { showToken = !showToken }) {
+                    Icon(
+                        imageVector = if (showToken) {
+                            Icons.Default.VisibilityOff
+                        } else {
+                            Icons.Default.Visibility
+                        },
+                        contentDescription = if (showToken) {
+                            stringResource(R.string.config_token_hide)
+                        } else {
+                            stringResource(R.string.config_token_show)
+                        },
+                    )
+                }
+            }
+
+            Spacer(modifier = Modifier.height(8.dp))
+
+            val connectionString = "URL: $serverUrl\nToken: $bearerToken"
+            TextButton(
+                onClick = { onCopyAll(connectionString) },
+                modifier = Modifier.align(Alignment.End),
+            ) {
+                Icon(
+                    imageVector = Icons.Default.ContentCopy,
+                    contentDescription = null,
+                )
+                Text(
+                    text = stringResource(R.string.connection_info_copy_all),
+                    modifier = Modifier.padding(start = 4.dp),
+                )
+            }
+        }
+    }
+}
+
+@Composable
+private fun ConnectionInfoRow(
+    label: String,
+    value: String,
+) {
+    Row(
+        modifier = Modifier.padding(vertical = 2.dp),
+    ) {
+        Text(
+            text = "$label: ",
+            style = MaterialTheme.typography.bodyMedium,
+            color = MaterialTheme.colorScheme.onSurfaceVariant,
+        )
+        Text(
+            text = value,
+            style = MaterialTheme.typography.bodyMedium,
+        )
+    }
+}
+
+@Preview(showBackground = true)
+@Composable
+private fun ConnectionInfoCardPreview() {
+    AndroidRemoteControlMcpTheme {
+        ConnectionInfoCard(
+            bindingAddress = BindingAddress.LOCALHOST,
+            ipAddress = "192.168.1.100",
+            port = 8080,
+            httpsEnabled = false,
+            bearerToken = "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
+            onCopyAll = {},
+        )
+    }
+}
```

---

#### Action 3.3.4: Create `PermissionsSection.kt`

**What**: Create the permissions section that shows the status of required permissions and provides quick-link buttons to enable them.

**Context**: The app needs three permissions: Accessibility Service (system setting), MediaProjection (runtime dialog), and Notification (API 33+ runtime permission). Each permission row shows a status indicator (enabled/disabled) and an action button. Accessibility Service opens Android Settings via an intent. MediaProjection and Notification permission buttons trigger callbacks that the Activity handles.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/PermissionsSection.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/PermissionsSection.kt
@@ -0,0 +1,118 @@
+package com.danielealbano.androidremotecontrolmcp.ui.components
+
+import androidx.compose.foundation.layout.Column
+import androidx.compose.foundation.layout.Row
+import androidx.compose.foundation.layout.Spacer
+import androidx.compose.foundation.layout.fillMaxWidth
+import androidx.compose.foundation.layout.height
+import androidx.compose.foundation.layout.padding
+import androidx.compose.foundation.layout.size
+import androidx.compose.foundation.layout.width
+import androidx.compose.material.icons.Icons
+import androidx.compose.material.icons.filled.CheckCircle
+import androidx.compose.material.icons.filled.Error
+import androidx.compose.material3.ElevatedCard
+import androidx.compose.material3.Icon
+import androidx.compose.material3.MaterialTheme
+import androidx.compose.material3.OutlinedButton
+import androidx.compose.material3.Text
+import androidx.compose.runtime.Composable
+import androidx.compose.ui.Alignment
+import androidx.compose.ui.Modifier
+import androidx.compose.ui.graphics.Color
+import androidx.compose.ui.res.stringResource
+import androidx.compose.ui.tooling.preview.Preview
+import androidx.compose.ui.unit.dp
+import com.danielealbano.androidremotecontrolmcp.R
+import com.danielealbano.androidremotecontrolmcp.ui.theme.AndroidRemoteControlMcpTheme
+
+private val EnabledColor = Color(0xFF4CAF50)
+private val DisabledColor = Color(0xFFF44336)
+
+@Composable
+fun PermissionsSection(
+    isAccessibilityEnabled: Boolean,
+    onOpenAccessibilitySettings: () -> Unit,
+    onRequestNotificationPermission: () -> Unit,
+    modifier: Modifier = Modifier,
+) {
+    ElevatedCard(
+        modifier = modifier.fillMaxWidth(),
+    ) {
+        Column(
+            modifier = Modifier.padding(16.dp),
+        ) {
+            Text(
+                text = stringResource(R.string.permissions_title),
+                style = MaterialTheme.typography.titleLarge,
+            )
+
+            Spacer(modifier = Modifier.height(12.dp))
+
+            PermissionRow(
+                label = stringResource(R.string.permission_accessibility),
+                isEnabled = isAccessibilityEnabled,
+                buttonText = if (isAccessibilityEnabled) {
+                    stringResource(R.string.permission_enabled)
+                } else {
+                    stringResource(R.string.permission_enable)
+                },
+                onAction = onOpenAccessibilitySettings,
+                actionEnabled = !isAccessibilityEnabled,
+            )
+
+            Spacer(modifier = Modifier.height(8.dp))
+
+            PermissionRow(
+                label = stringResource(R.string.permission_notifications),
+                isEnabled = true,
+                buttonText = stringResource(R.string.permission_grant),
+                onAction = onRequestNotificationPermission,
+                actionEnabled = true,
+            )
+        }
+    }
+}
+
+@Composable
+private fun PermissionRow(
+    label: String,
+    isEnabled: Boolean,
+    buttonText: String,
+    onAction: () -> Unit,
+    actionEnabled: Boolean,
+) {
+    Row(
+        modifier = Modifier
+            .fillMaxWidth()
+            .padding(vertical = 4.dp),
+        verticalAlignment = Alignment.CenterVertically,
+    ) {
+        Icon(
+            imageVector = if (isEnabled) Icons.Default.CheckCircle else Icons.Default.Error,
+            contentDescription = if (isEnabled) {
+                "$label enabled"
+            } else {
+                "$label disabled"
+            },
+            tint = if (isEnabled) EnabledColor else DisabledColor,
+            modifier = Modifier.size(24.dp),
+        )
+        Spacer(modifier = Modifier.width(8.dp))
+        Text(
+            text = label,
+            style = MaterialTheme.typography.bodyLarge,
+            modifier = Modifier.weight(1f),
+        )
+        OutlinedButton(
+            onClick = onAction,
+            enabled = actionEnabled,
+        ) {
+            Text(text = buttonText)
+        }
+    }
+}
+
+@Preview(showBackground = true)
+@Composable
+private fun PermissionsSectionPreview() {
+    AndroidRemoteControlMcpTheme {
+        PermissionsSection(
+            isAccessibilityEnabled = false,
+            onOpenAccessibilitySettings = {},
+            onRequestNotificationPermission = {},
+        )
+    }
+}
```

> **Implementation Note on MediaProjection**: MediaProjection permission is not shown as a separate row in this section because it requires launching a system intent that returns a result. It is handled by the service lifecycle (Plan 5/6). The notification permission row always shows as enabled for simplicity at this stage; full runtime permission checking with `rememberPermissionState` from Accompanist will be refined when the services are wired in Plan 6. The button still provides a callback so it can be used to trigger the permission request flow.

---

### Task 3.4: Create HomeScreen and Update MainActivity

**Description**: Create the HomeScreen composable that assembles all components into a scrollable layout, update MainActivity to use the theme and HomeScreen, and update strings.xml with all UI strings.

**Acceptance Criteria**:
- [ ] HomeScreen uses Scaffold with TopAppBar titled "MCP Remote Control"
- [ ] HomeScreen renders ServerStatusCard, ConfigurationSection, PermissionsSection, ConnectionInfoCard in a Column with proper spacing
- [ ] HomeScreen observes ViewModel state via `collectAsState()`
- [ ] HomeScreen refreshes permission status on resume via `LifecycleEventObserver`
- [ ] MainActivity is annotated with `@AndroidEntryPoint`
- [ ] MainActivity calls `setContent { AndroidRemoteControlMcpTheme { HomeScreen() } }`
- [ ] MainActivity handles accessibility settings intent
- [ ] strings.xml contains all string resources used by UI components
- [ ] All strings match PROJECT.md text exactly (especially the security warning)

**Tests**: Integration tests are written in Task 3.7. Build and lint verification at user story level.

#### Action 3.4.1: Create `HomeScreen.kt`

**What**: Create the main screen composable that assembles all UI components.

**Context**: The HomeScreen is the top-level composable for the main (and only) screen. It uses a `Scaffold` with a `TopAppBar` for the title. The body is a `Column` (not `LazyColumn`, since the content is short enough to not require lazy loading) with all four sections. It observes the ViewModel state using `collectAsState()` and passes state/callbacks down to child components. It also registers a `LifecycleEventObserver` to refresh permission status whenever the activity resumes (user might return from Android Settings after enabling accessibility).

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/screens/HomeScreen.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/screens/HomeScreen.kt
@@ -0,0 +1,122 @@
+package com.danielealbano.androidremotecontrolmcp.ui.screens
+
+import android.content.Intent
+import android.provider.Settings
+import androidx.compose.foundation.layout.Arrangement
+import androidx.compose.foundation.layout.Column
+import androidx.compose.foundation.layout.fillMaxSize
+import androidx.compose.foundation.layout.padding
+import androidx.compose.foundation.rememberScrollState
+import androidx.compose.foundation.verticalScroll
+import androidx.compose.material3.ExperimentalMaterial3Api
+import androidx.compose.material3.MaterialTheme
+import androidx.compose.material3.Scaffold
+import androidx.compose.material3.Text
+import androidx.compose.material3.TopAppBar
+import androidx.compose.material3.TopAppBarDefaults
+import androidx.compose.runtime.Composable
+import androidx.compose.runtime.DisposableEffect
+import androidx.compose.runtime.getValue
+import androidx.compose.ui.Modifier
+import androidx.compose.ui.platform.LocalContext
+import androidx.compose.ui.res.stringResource
+import androidx.compose.ui.unit.dp
+import androidx.hilt.navigation.compose.hiltViewModel
+import androidx.lifecycle.Lifecycle
+import androidx.lifecycle.LifecycleEventObserver
+import androidx.lifecycle.compose.LocalLifecycleOwner
+import androidx.lifecycle.compose.collectAsStateWithLifecycle
+import com.danielealbano.androidremotecontrolmcp.R
+import com.danielealbano.androidremotecontrolmcp.data.model.ServerStatus
+import com.danielealbano.androidremotecontrolmcp.ui.components.ConfigurationSection
+import com.danielealbano.androidremotecontrolmcp.ui.components.ConnectionInfoCard
+import com.danielealbano.androidremotecontrolmcp.ui.components.PermissionsSection
+import com.danielealbano.androidremotecontrolmcp.ui.components.ServerStatusCard
+import com.danielealbano.androidremotecontrolmcp.ui.viewmodels.MainViewModel
+import com.danielealbano.androidremotecontrolmcp.utils.NetworkUtils
+
+@OptIn(ExperimentalMaterial3Api::class)
+@Composable
+fun HomeScreen(
+    viewModel: MainViewModel = hiltViewModel(),
+) {
+    val context = LocalContext.current
+    val lifecycleOwner = LocalLifecycleOwner.current
+
+    val serverConfig by viewModel.serverConfig.collectAsStateWithLifecycle()
+    val serverStatus by viewModel.serverStatus.collectAsStateWithLifecycle()
+    val portInput by viewModel.portInput.collectAsStateWithLifecycle()
+    val portError by viewModel.portError.collectAsStateWithLifecycle()
+    val hostnameInput by viewModel.hostnameInput.collectAsStateWithLifecycle()
+    val hostnameError by viewModel.hostnameError.collectAsStateWithLifecycle()
+    val isAccessibilityEnabled by viewModel.isAccessibilityEnabled.collectAsStateWithLifecycle()
+
+    val isServerRunning = serverStatus is ServerStatus.Running ||
+        serverStatus is ServerStatus.Starting
+
+    DisposableEffect(lifecycleOwner) {
+        val observer = LifecycleEventObserver { _, event ->
+            if (event == Lifecycle.Event.ON_RESUME) {
+                viewModel.refreshPermissionStatus(context)
+            }
+        }
+        lifecycleOwner.lifecycle.addObserver(observer)
+        onDispose {
+            lifecycleOwner.lifecycle.removeObserver(observer)
+        }
+    }
+
+    Scaffold(
+        topBar = {
+            TopAppBar(
+                title = {
+                    Text(text = stringResource(R.string.app_bar_title))
+                },
+                colors = TopAppBarDefaults.topAppBarColors(
+                    containerColor = MaterialTheme.colorScheme.primaryContainer,
+                    titleContentColor = MaterialTheme.colorScheme.onPrimaryContainer,
+                ),
+            )
+        },
+    ) { innerPadding ->
+        Column(
+            modifier = Modifier
+                .fillMaxSize()
+                .padding(innerPadding)
+                .padding(horizontal = 16.dp, vertical = 8.dp)
+                .verticalScroll(rememberScrollState()),
+            verticalArrangement = Arrangement.spacedBy(12.dp),
+        ) {
+            ServerStatusCard(
+                status = serverStatus,
+                onStartClick = viewModel::startServer,
+                onStopClick = viewModel::stopServer,
+            )
+
+            ConfigurationSection(
+                bindingAddress = serverConfig.bindingAddress,
+                portInput = portInput,
+                portError = portError,
+                bearerToken = serverConfig.bearerToken,
+                autoStartEnabled = serverConfig.autoStartOnBoot,
+                certificateSource = serverConfig.certificateSource,
+                hostnameInput = hostnameInput,
+                hostnameError = hostnameError,
+                isServerRunning = isServerRunning,
+                onBindingAddressChange = viewModel::updateBindingAddress,
+                onPortChange = viewModel::updatePort,
+                onRegenerateToken = viewModel::generateNewBearerToken,
+                onCopyToken = { viewModel.copyToClipboard(context, serverConfig.bearerToken) },
+                onAutoStartChange = viewModel::updateAutoStartOnBoot,
+                onCertificateSourceChange = viewModel::updateCertificateSource,
+                onHostnameChange = viewModel::updateCertificateHostname,
+            )
+
+            PermissionsSection(
+                isAccessibilityEnabled = isAccessibilityEnabled,
+                onOpenAccessibilitySettings = {
+                    context.startActivity(
+                        Intent(Settings.ACTION_ACCESSIBILITY_SETTINGS),
+                    )
+                },
+                onRequestNotificationPermission = {
+                    // Notification permission handling will be refined in Plan 6
+                },
+            )
+
+            ConnectionInfoCard(
+                bindingAddress = serverConfig.bindingAddress,
+                ipAddress = NetworkUtils.getDeviceIpAddress(context) ?: "N/A",
+                port = serverConfig.port,
+                httpsEnabled = serverConfig.httpsEnabled,
+                bearerToken = serverConfig.bearerToken,
+                onCopyAll = { connectionString ->
+                    viewModel.copyToClipboard(context, connectionString)
+                },
+            )
+        }
+    }
+}
```

> **Implementation Note**: `collectAsStateWithLifecycle()` is used instead of `collectAsState()` because it is lifecycle-aware and automatically stops/starts collection based on the lifecycle state, reducing unnecessary work when the app is in the background. This requires the `lifecycle-runtime-compose` dependency which is already in `libs.versions.toml` from Plan 1. `NetworkUtils.getDeviceIpAddress(context: Context)` is defined in Plan 2 as a companion method that takes a `Context` parameter and returns `String?` (nullable). The `?: "N/A"` fallback handles the null case when no network address is available.

> **Implementation Note**: Consider including `ServerStatus.Stopping` in `isServerRunning` to prevent configuration changes during shutdown.

> **Implementation Note on scroll**: A `verticalScroll` modifier is used on the Column because the settings form can exceed the screen height on small devices. This provides scrolling without needing `LazyColumn` (which would be overkill for 4 cards).

---

#### Action 3.4.2: Update `strings.xml`

**What**: Add all UI string resources used by the composables.

**Context**: String resources are defined in `strings.xml` for i18n support and for use with `stringResource()` in Compose. The security warning message text matches PROJECT.md exactly. Existing strings from Plan 1 are preserved and new strings are appended.

**File**: `app/src/main/res/values/strings.xml`

The existing file from Plan 1 contains:
```xml
<resources>
    <string name="app_name">Android Remote Control MCP</string>
    <string name="accessibility_service_description">...</string>
    <string name="notification_channel_mcp_server_id">...</string>
    <string name="notification_channel_mcp_server_name">...</string>
    <string name="notification_channel_screen_capture_id">...</string>
    <string name="notification_channel_screen_capture_name">...</string>
    <string name="notification_mcp_server_title">...</string>
    <string name="notification_screen_capture_title">...</string>
</resources>
```

```diff
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -14,4 +14,53 @@
     <!-- Notification Content -->
     <string name="notification_mcp_server_title">MCP Server Running</string>
     <string name="notification_screen_capture_title">Screen Capture Active</string>
+
+    <!-- App Bar -->
+    <string name="app_bar_title">MCP Remote Control</string>
+
+    <!-- Server Status -->
+    <string name="server_status_title">Server Status</string>
+    <string name="server_status_running">Running</string>
+    <string name="server_status_stopped">Stopped</string>
+    <string name="server_status_starting">Starting…</string>
+    <string name="server_status_stopping">Stopping…</string>
+    <string name="server_status_error">Error: %1$s</string>
+    <string name="server_action_start">Start</string>
+    <string name="server_action_stop">Stop</string>
+
+    <!-- Configuration -->
+    <string name="configuration_title">Configuration</string>
+    <string name="config_binding_address_label">Binding Address</string>
+    <string name="config_binding_localhost">Localhost (127.0.0.1)</string>
+    <string name="config_binding_network">Network (0.0.0.0)</string>
+    <string name="config_port_label">Port</string>
+    <string name="config_bearer_token_label">Bearer Token</string>
+    <string name="config_token_show">Show token</string>
+    <string name="config_token_hide">Hide token</string>
+    <string name="config_token_copy">Copy token</string>
+    <string name="config_token_regenerate">Regenerate token</string>
+    <string name="config_auto_start_label">Auto-start on boot</string>
+    <string name="config_certificate_title">HTTPS Certificate</string>
+    <string name="config_cert_auto_generated">Auto-generated self-signed</string>
+    <string name="config_cert_custom">Custom certificate (.p12/.pfx)</string>
+    <string name="config_hostname_label">Certificate hostname</string>
+
+    <!-- Network Security Warning -->
+    <string name="network_warning_title">Network Exposure Warning</string>
+    <string name="network_warning_message">Binding to 0.0.0.0 makes the MCP server accessible to:\n\n\u2022 All devices on your current WiFi network\n\u2022 Devices connected to your hotspot\n\u2022 Potentially other devices depending on network configuration\n\nThis is a SECURITY RISK on public/untrusted networks.\n\nOnly use this option on trusted private networks.</string>
+    <string name="network_warning_confirm">I Understand, Continue</string>
+    <string name="network_warning_cancel">Cancel</string>
+
+    <!-- Permissions -->
+    <string name="permissions_title">Permissions</string>
+    <string name="permission_accessibility">Accessibility Service</string>
+    <string name="permission_notifications">Notifications</string>
+    <string name="permission_enable">Enable</string>
+    <string name="permission_enabled">Enabled</string>
+    <string name="permission_grant">Grant</string>
+
+    <!-- Connection Info -->
+    <string name="connection_info_title">Connection Info</string>
+    <string name="connection_info_ip">IP Address</string>
+    <string name="connection_info_port">Port</string>
+    <string name="connection_info_url">URL</string>
+    <string name="connection_info_token">Token</string>
+    <string name="connection_info_copy_all">Copy All</string>
 </resources>
```

> **Implementation Note on security warning text**: The `network_warning_message` string uses `\n` for newlines and `\u2022` for bullet points. The content matches the text specified in PROJECT.md under "Security Warning UI". The title uses a plain text title (no emoji) to keep it compatible with all Android rendering contexts.

---

#### Action 3.4.3: Update `MainActivity.kt`

**What**: Rewrite the stub MainActivity to use the theme and HomeScreen composable.

**Context**: The existing stub from Plan 1 just displays a `Text("Android Remote Control MCP")`. This action replaces it with the full Compose setup: `AndroidRemoteControlMcpTheme { HomeScreen() }`. The `enableEdgeToEdge()` call enables modern edge-to-edge display. The activity is annotated with `@AndroidEntryPoint` for Hilt injection (required for `hiltViewModel()` in HomeScreen).

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/MainActivity.kt`

The existing file from Plan 1:
```kotlin
package com.danielealbano.androidremotecontrolmcp.ui

import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.compose.material3.Text
import dagger.hilt.android.AndroidEntryPoint

@AndroidEntryPoint
class MainActivity : ComponentActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            Text("Android Remote Control MCP")
        }
    }

    companion object {
        private const val TAG = "MCP:MainActivity"
    }
}
```

```diff
--- a/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/MainActivity.kt
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/MainActivity.kt
@@ -3,8 +3,9 @@
 import android.os.Bundle
 import androidx.activity.ComponentActivity
+import androidx.activity.enableEdgeToEdge
 import androidx.activity.compose.setContent
-import androidx.compose.material3.Text
 import dagger.hilt.android.AndroidEntryPoint
+import com.danielealbano.androidremotecontrolmcp.ui.screens.HomeScreen
+import com.danielealbano.androidremotecontrolmcp.ui.theme.AndroidRemoteControlMcpTheme

 @AndroidEntryPoint
 class MainActivity : ComponentActivity() {

     override fun onCreate(savedInstanceState: Bundle?) {
         super.onCreate(savedInstanceState)
+        enableEdgeToEdge()
         setContent {
-            Text("Android Remote Control MCP")
+            AndroidRemoteControlMcpTheme {
+                HomeScreen()
+            }
         }
     }

     companion object {
         private const val TAG = "MCP:MainActivity"
     }
 }
```

The full file after modification:

```kotlin
package com.danielealbano.androidremotecontrolmcp.ui

import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.activity.enableEdgeToEdge
import com.danielealbano.androidremotecontrolmcp.ui.screens.HomeScreen
import com.danielealbano.androidremotecontrolmcp.ui.theme.AndroidRemoteControlMcpTheme
import dagger.hilt.android.AndroidEntryPoint

@AndroidEntryPoint
class MainActivity : ComponentActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        enableEdgeToEdge()
        setContent {
            AndroidRemoteControlMcpTheme {
                HomeScreen()
            }
        }
    }

    companion object {
        private const val TAG = "MCP:MainActivity"
    }
}
```

---

### Task 3.5: Add `hilt-navigation-compose` Dependency

**Description**: The `hiltViewModel()` function used in `HomeScreen.kt` requires the `hilt-navigation-compose` library. This must be added to the version catalog and app build script.

**Acceptance Criteria**:
- [ ] `hilt-navigation-compose` library is declared in `gradle/libs.versions.toml`
- [ ] `hilt-navigation-compose` is added as an implementation dependency in `app/build.gradle.kts`
- [ ] `hiltViewModel()` call compiles successfully

**Tests**: No dedicated tests. Build verification at user story level.

#### Action 3.5.1: Update `gradle/libs.versions.toml`

**What**: Add the `hilt-navigation-compose` library entry to the version catalog.

**Context**: `hiltViewModel()` is provided by `androidx.hilt:hilt-navigation-compose`. This library bridges Hilt and Compose Navigation, providing the `hiltViewModel()` composable function used to obtain `@HiltViewModel` instances inside composables.

```diff
--- a/gradle/libs.versions.toml
+++ b/gradle/libs.versions.toml
@@ in [versions] section, add: @@
+hilt-navigation-compose = "1.2.0"    # verify latest at implementation time

@@ in [libraries] section, after hilt-compiler line, add: @@
+hilt-navigation-compose = { group = "androidx.hilt", name = "hilt-navigation-compose", version.ref = "hilt-navigation-compose" }
```

> **Implementation Note**: Verify the latest version of `androidx.hilt:hilt-navigation-compose` at implementation time. As of early 2026, version 1.2.0 is expected to be current.

---

#### Action 3.5.2: Update `app/build.gradle.kts`

**What**: Add the `hilt-navigation-compose` dependency.

```diff
--- a/app/build.gradle.kts
+++ b/app/build.gradle.kts
@@ in dependencies block, after hilt-compiler line, add: @@
+    implementation(libs.hilt.navigation.compose)
```

---

### Task 3.6: Add Server Logs Viewer Data Model and UI Component

**Description**: Create the `ServerLogEntry` data class, add a bounded `StateFlow<List<ServerLogEntry>>` to `MainViewModel`, and create the `ServerLogsSection` composable that displays the log entries. At this stage (Plan 3), the log list will be empty -- actual log entries will be emitted by `McpServerService` in Plan 6. This task only sets up the data model, ViewModel support, and UI component.

**Acceptance Criteria**:
- [ ] `ServerLogEntry` data class has `timestamp: Long`, `toolName: String`, `params: String`, `durationMs: Long` fields
- [ ] `MainViewModel` exposes `serverLogs: StateFlow<List<ServerLogEntry>>` backed by a `MutableStateFlow(emptyList())`
- [ ] `MainViewModel` has an `addServerLogEntry(entry: ServerLogEntry)` method that adds entries and trims the list to `MAX_LOG_ENTRIES` (100)
- [ ] `ServerLogsSection` composable displays log entries in a scrollable list inside an `ElevatedCard`
- [ ] Each log entry row shows: tool name, truncated params (max 100 chars), and duration in milliseconds
- [ ] When the list is empty, a "No log entries yet" placeholder is shown
- [ ] The `ServerLogsSection` is added to `HomeScreen` layout (between PermissionsSection and ConnectionInfoCard)
- [ ] New string resources are added to `strings.xml`
- [ ] File compiles without errors and passes lint

**Tests**: Unit tests for the ViewModel log additions are covered in Task 3.7. Build and lint verification at user story level.

#### Action 3.6.1: Create `ServerLogEntry.kt`

**What**: Create the data class representing a single server log entry.

**Context**: This data class is the model for server log entries displayed in the UI. Each entry captures an MCP tool invocation or HTTP request with its tool/endpoint name, parameters (truncated for display), and execution duration. The `timestamp` field uses epoch milliseconds for sorting. The `params` field is pre-truncated at the call site (when creating the entry) to 100 characters.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/data/model/ServerLogEntry.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/data/model/ServerLogEntry.kt
@@ -0,0 +1,22 @@
+package com.danielealbano.androidremotecontrolmcp.data.model
+
+/**
+ * Represents a single log entry from the MCP server, displayed in the
+ * server logs viewer UI.
+ *
+ * @property timestamp The epoch milliseconds when the request was received.
+ * @property toolName The MCP tool or HTTP endpoint name invoked.
+ * @property params The request parameters, truncated to [MAX_PARAMS_LENGTH] characters for display.
+ * @property durationMs The request processing duration in milliseconds.
+ */
+data class ServerLogEntry(
+    val timestamp: Long,
+    val toolName: String,
+    val params: String,
+    val durationMs: Long,
+) {
+    companion object {
+        const val MAX_PARAMS_LENGTH = 100
+    }
+}
```

---

#### Action 3.6.2: Update `MainViewModel.kt` with server logs StateFlow

**What**: Add a `serverLogs` StateFlow and an `addServerLogEntry` method to the MainViewModel.

**Context**: The ViewModel holds a bounded list of server log entries (last 100) exposed as a `StateFlow`. The `addServerLogEntry` method is public so that Plan 6 can wire `McpServerService` to emit entries into the ViewModel. The list is trimmed from the front (oldest entries removed) when it exceeds `MAX_LOG_ENTRIES`.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModel.kt`

```diff
--- a/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModel.kt
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModel.kt
@@ add import @@
+import com.danielealbano.androidremotecontrolmcp.data.model.ServerLogEntry

@@ after _isAccessibilityEnabled / isAccessibilityEnabled declarations, add: @@
+    private val _serverLogs = MutableStateFlow<List<ServerLogEntry>>(emptyList())
+    val serverLogs: StateFlow<List<ServerLogEntry>> = _serverLogs.asStateFlow()

@@ after refreshPermissionStatus method, add: @@
+    fun addServerLogEntry(entry: ServerLogEntry) {
+        val currentLogs = _serverLogs.value.toMutableList()
+        currentLogs.add(entry)
+        if (currentLogs.size > MAX_LOG_ENTRIES) {
+            _serverLogs.value = currentLogs.drop(currentLogs.size - MAX_LOG_ENTRIES)
+        } else {
+            _serverLogs.value = currentLogs
+        }
+    }

@@ in companion object, add: @@
+        private const val MAX_LOG_ENTRIES = 100
```

---

#### Action 3.6.3: Create `ServerLogsSection.kt`

**What**: Create the server logs viewer composable that displays a scrollable list of log entries.

**Context**: This composable is a simple `ElevatedCard` containing a `LazyColumn` (or scrollable `Column`) of log entries. Each entry row shows the tool name, truncated params, and duration. When the list is empty, a centered placeholder text is shown. The component uses state hoisting -- it receives the log list as a parameter.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ServerLogsSection.kt`

```diff
--- /dev/null
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ServerLogsSection.kt
@@ -0,0 +1,120 @@
+package com.danielealbano.androidremotecontrolmcp.ui.components
+
+import androidx.compose.foundation.layout.Column
+import androidx.compose.foundation.layout.Row
+import androidx.compose.foundation.layout.Spacer
+import androidx.compose.foundation.layout.fillMaxWidth
+import androidx.compose.foundation.layout.height
+import androidx.compose.foundation.layout.heightIn
+import androidx.compose.foundation.layout.padding
+import androidx.compose.foundation.layout.width
+import androidx.compose.foundation.lazy.LazyColumn
+import androidx.compose.foundation.lazy.items
+import androidx.compose.material3.ElevatedCard
+import androidx.compose.material3.HorizontalDivider
+import androidx.compose.material3.MaterialTheme
+import androidx.compose.material3.Text
+import androidx.compose.runtime.Composable
+import androidx.compose.ui.Alignment
+import androidx.compose.ui.Modifier
+import androidx.compose.ui.res.stringResource
+import androidx.compose.ui.text.style.TextOverflow
+import androidx.compose.ui.tooling.preview.Preview
+import androidx.compose.ui.unit.dp
+import com.danielealbano.androidremotecontrolmcp.R
+import com.danielealbano.androidremotecontrolmcp.data.model.ServerLogEntry
+import com.danielealbano.androidremotecontrolmcp.ui.theme.AndroidRemoteControlMcpTheme
+import java.text.SimpleDateFormat
+import java.util.Date
+import java.util.Locale
+
+private const val MAX_LOG_LIST_HEIGHT_DP = 300
+private const val TIME_FORMAT_PATTERN = "HH:mm:ss"
+
+@Composable
+fun ServerLogsSection(
+    logs: List<ServerLogEntry>,
+    modifier: Modifier = Modifier,
+) {
+    ElevatedCard(
+        modifier = modifier.fillMaxWidth(),
+    ) {
+        Column(
+            modifier = Modifier.padding(16.dp),
+        ) {
+            Text(
+                text = stringResource(R.string.server_logs_title),
+                style = MaterialTheme.typography.titleLarge,
+            )
+
+            Spacer(modifier = Modifier.height(12.dp))
+
+            if (logs.isEmpty()) {
+                Text(
+                    text = stringResource(R.string.server_logs_empty),
+                    style = MaterialTheme.typography.bodyMedium,
+                    color = MaterialTheme.colorScheme.onSurfaceVariant,
+                    modifier = Modifier.padding(vertical = 16.dp),
+                )
+            } else {
+                LazyColumn(
+                    modifier = Modifier
+                        .fillMaxWidth()
+                        .heightIn(max = MAX_LOG_LIST_HEIGHT_DP.dp),
+                ) {
+                    items(logs.reversed()) { entry ->
+                        ServerLogEntryRow(entry = entry)
+                        HorizontalDivider()
+                    }
+                }
+            }
+        }
+    }
+}
+
+@Composable
+private fun ServerLogEntryRow(entry: ServerLogEntry) {
+    val timeFormat = SimpleDateFormat(TIME_FORMAT_PATTERN, Locale.getDefault())
+    val timeString = timeFormat.format(Date(entry.timestamp))
+
+    Row(
+        modifier = Modifier
+            .fillMaxWidth()
+            .padding(vertical = 6.dp),
+        verticalAlignment = Alignment.CenterVertically,
+    ) {
+        Text(
+            text = timeString,
+            style = MaterialTheme.typography.labelSmall,
+            color = MaterialTheme.colorScheme.onSurfaceVariant,
+        )
+        Spacer(modifier = Modifier.width(8.dp))
+        Text(
+            text = entry.toolName,
+            style = MaterialTheme.typography.bodyMedium,
+            modifier = Modifier.weight(1f),
+            maxLines = 1,
+            overflow = TextOverflow.Ellipsis,
+        )
+        Spacer(modifier = Modifier.width(8.dp))
+        Text(
+            text = "${entry.durationMs}ms",
+            style = MaterialTheme.typography.labelSmall,
+            color = MaterialTheme.colorScheme.onSurfaceVariant,
+        )
+    }
+    if (entry.params.isNotEmpty()) {
+        Text(
+            text = entry.params,
+            style = MaterialTheme.typography.bodySmall,
+            color = MaterialTheme.colorScheme.onSurfaceVariant,
+            maxLines = 1,
+            overflow = TextOverflow.Ellipsis,
+            modifier = Modifier.padding(start = 56.dp, bottom = 4.dp),
+        )
+    }
+}
+
+@Preview(showBackground = true)
+@Composable
+private fun ServerLogsSectionEmptyPreview() {
+    AndroidRemoteControlMcpTheme {
+        ServerLogsSection(logs = emptyList())
+    }
+}
```

> **Implementation Note**: The list is displayed in reverse chronological order (`logs.reversed()`) so the most recent entries appear at the top. `LazyColumn` is used because the list can hold up to 100 entries. The height is constrained via `heightIn(max = 300.dp)` to prevent the section from dominating the screen. `SimpleDateFormat` with `HH:mm:ss` pattern shows the time portion of the timestamp for compact display. The params line is indented and only shown if non-empty.

> **Implementation Note — Compose scrolling**: `LazyColumn` inside a `verticalScroll` Column is a known Compose anti-pattern. The `heightIn(max = 300.dp)` constraint bounds the LazyColumn's height to prevent unbounded measurement. At implementation time, verify this works correctly or replace with a regular `Column` with `items.take(maxVisibleItems)`.

---

#### Action 3.6.4: Update `HomeScreen.kt` to include `ServerLogsSection`

**What**: Add the `ServerLogsSection` composable to the HomeScreen layout.

**Context**: The `ServerLogsSection` is placed between `PermissionsSection` and `ConnectionInfoCard` in the screen layout. It observes the `serverLogs` StateFlow from the ViewModel via `collectAsStateWithLifecycle()`.

**File**: `app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/screens/HomeScreen.kt`

```diff
--- a/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/screens/HomeScreen.kt
+++ b/app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/screens/HomeScreen.kt
@@ add import @@
+import com.danielealbano.androidremotecontrolmcp.ui.components.ServerLogsSection

@@ after collecting isAccessibilityEnabled, add: @@
+    val serverLogs by viewModel.serverLogs.collectAsStateWithLifecycle()

@@ in Scaffold body Column, between PermissionsSection and ConnectionInfoCard, add: @@
+            ServerLogsSection(
+                logs = serverLogs,
+            )
```

The updated HomeScreen section (inside the Column) should read:
```kotlin
            ServerStatusCard(...)

            ConfigurationSection(...)

            PermissionsSection(...)

            ServerLogsSection(
                logs = serverLogs,
            )

            ConnectionInfoCard(...)
```

---

#### Action 3.6.5: Update `strings.xml` with server logs strings

**What**: Add string resources for the server logs section.

**File**: `app/src/main/res/values/strings.xml`

```diff
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ before Connection Info section, add: @@
+    <!-- Server Logs -->
+    <string name="server_logs_title">Server Logs</string>
+    <string name="server_logs_empty">No log entries yet</string>
```

---

### Task 3.7: Add Unit Tests for MainViewModel

**Description**: Write comprehensive unit tests for `MainViewModel` covering state loading, input validation, settings updates, and action methods.

**Acceptance Criteria**:
- [ ] Test initial state loading from mocked repository
- [ ] Test port validation: valid port (e.g., 8080)
- [ ] Test port validation: port too low (0)
- [ ] Test port validation: port too high (65536)
- [ ] Test port validation: non-numeric input
- [ ] Test port validation: empty input
- [ ] Test binding address update calls repository
- [ ] Test bearer token regeneration calls repository
- [ ] Test auto-start toggle calls repository
- [ ] Test certificate source update calls repository
- [ ] Test certificate hostname validation: valid hostname
- [ ] Test certificate hostname validation: empty hostname
- [ ] Test certificate hostname validation: invalid format
- [ ] All tests use MockK for SettingsRepository mock
- [ ] All tests use Turbine for StateFlow testing
- [ ] All tests follow Arrange-Act-Assert pattern
- [ ] All tests pass

**Tests**: This IS the test task. Run with `./gradlew test --tests "*MainViewModelTest"`.

#### Action 3.7.1: Create `MainViewModelTest.kt`

**What**: Create the unit test file for MainViewModel.

**Context**: The test mocks `SettingsRepository` using MockK and uses Turbine to test StateFlow emissions. Each test follows Arrange-Act-Assert. The `Dispatchers.Main` is replaced with `StandardTestDispatcher` using `Dispatchers.setMain()` in `@BeforeEach`. The repository mock emits a `ServerConfig` via a `MutableSharedFlow` to simulate the settings flow.

**File**: `app/src/test/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModelTest.kt`

```diff
--- /dev/null
+++ b/app/src/test/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModelTest.kt
@@ -0,0 +1,222 @@
+package com.danielealbano.androidremotecontrolmcp.ui.viewmodels
+
+import app.cash.turbine.test
+import com.danielealbano.androidremotecontrolmcp.data.model.BindingAddress
+import com.danielealbano.androidremotecontrolmcp.data.model.CertificateSource
+import com.danielealbano.androidremotecontrolmcp.data.model.ServerConfig
+import com.danielealbano.androidremotecontrolmcp.data.model.ServerStatus
+import com.danielealbano.androidremotecontrolmcp.data.repository.SettingsRepository
+import io.mockk.Runs
+import io.mockk.coEvery
+import io.mockk.coVerify
+import io.mockk.every
+import io.mockk.just
+import io.mockk.mockk
+import kotlinx.coroutines.Dispatchers
+import kotlinx.coroutines.ExperimentalCoroutinesApi
+import kotlinx.coroutines.flow.MutableStateFlow
+import kotlinx.coroutines.test.StandardTestDispatcher
+import kotlinx.coroutines.test.advanceUntilIdle
+import kotlinx.coroutines.test.resetMain
+import kotlinx.coroutines.test.runTest
+import kotlinx.coroutines.test.setMain
+import org.junit.jupiter.api.AfterEach
+import org.junit.jupiter.api.Assertions.assertEquals
+import org.junit.jupiter.api.Assertions.assertNull
+import org.junit.jupiter.api.BeforeEach
+import org.junit.jupiter.api.Test
+
+@OptIn(ExperimentalCoroutinesApi::class)
+class MainViewModelTest {
+
+    private val testDispatcher = StandardTestDispatcher()
+    private lateinit var settingsRepository: SettingsRepository
+    private lateinit var configFlow: MutableStateFlow<ServerConfig>
+    private lateinit var viewModel: MainViewModel
+
+    @BeforeEach
+    fun setUp() {
+        Dispatchers.setMain(testDispatcher)
+
+        configFlow = MutableStateFlow(
+            ServerConfig(
+                port = 8080,
+                bindingAddress = BindingAddress.LOCALHOST,
+                bearerToken = "test-token-123",
+                autoStartOnBoot = false,
+                certificateSource = CertificateSource.AUTO_GENERATED,
+                certificateHostname = "android-mcp.local",
+            ),
+        )
+
+        settingsRepository = mockk(relaxed = true)
+        every { settingsRepository.serverConfig } returns configFlow
+
+        viewModel = MainViewModel(settingsRepository)
+    }
+
+    @AfterEach
+    fun tearDown() {
+        Dispatchers.resetMain()
+    }
+
+    @Test
+    fun `initial state loads from repository`() = runTest {
+        advanceUntilIdle()
+
+        assertEquals(8080, viewModel.serverConfig.value.port)
+        assertEquals(BindingAddress.LOCALHOST, viewModel.serverConfig.value.bindingAddress)
+        assertEquals("test-token-123", viewModel.serverConfig.value.bearerToken)
+        assertEquals("8080", viewModel.portInput.value)
+        assertEquals("android-mcp.local", viewModel.hostnameInput.value)
+    }
+
+    @Test
+    fun `initial server status is Stopped`() = runTest {
+        assertEquals(ServerStatus.Stopped, viewModel.serverStatus.value)
+    }
+
+    @Test
+    fun `updatePort with valid port clears error and saves`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updatePort("9090")
+        advanceUntilIdle()
+
+        assertEquals("9090", viewModel.portInput.value)
+        assertNull(viewModel.portError.value)
+        coVerify { settingsRepository.updatePort(9090) }
+    }
+
+    @Test
+    fun `updatePort with port too low sets error`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updatePort("0")
+        advanceUntilIdle()
+
+        assertEquals("0", viewModel.portInput.value)
+        assertEquals("Port must be between 1 and 65535", viewModel.portError.value)
+        coVerify(exactly = 0) { settingsRepository.updatePort(0) }
+    }
+
+    @Test
+    fun `updatePort with port too high sets error`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updatePort("65536")
+        advanceUntilIdle()
+
+        assertEquals("65536", viewModel.portInput.value)
+        assertEquals("Port must be between 1 and 65535", viewModel.portError.value)
+        coVerify(exactly = 0) { settingsRepository.updatePort(65536) }
+    }
+
+    @Test
+    fun `updatePort with non-numeric input sets error`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updatePort("abc")
+        advanceUntilIdle()
+
+        assertEquals("abc", viewModel.portInput.value)
+        assertEquals("Port must be a number", viewModel.portError.value)
+    }
+
+    @Test
+    fun `updatePort with empty input sets error`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updatePort("")
+        advanceUntilIdle()
+
+        assertEquals("", viewModel.portInput.value)
+        assertEquals("Port is required", viewModel.portError.value)
+    }
+
+    @Test
+    fun `updatePort with min valid port succeeds`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updatePort("1")
+        advanceUntilIdle()
+
+        assertNull(viewModel.portError.value)
+        coVerify { settingsRepository.updatePort(1) }
+    }
+
+    @Test
+    fun `updatePort with max valid port succeeds`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updatePort("65535")
+        advanceUntilIdle()
+
+        assertNull(viewModel.portError.value)
+        coVerify { settingsRepository.updatePort(65535) }
+    }
+
+    @Test
+    fun `updateBindingAddress calls repository`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updateBindingAddress(BindingAddress.NETWORK)
+        advanceUntilIdle()
+
+        coVerify { settingsRepository.updateBindingAddress(BindingAddress.NETWORK) }
+    }
+
+    @Test
+    fun `generateNewBearerToken calls repository`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.generateNewBearerToken()
+        advanceUntilIdle()
+
+        coVerify { settingsRepository.generateNewBearerToken() }
+    }
+
+    @Test
+    fun `updateAutoStartOnBoot calls repository`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updateAutoStartOnBoot(true)
+        advanceUntilIdle()
+
+        coVerify { settingsRepository.updateAutoStartOnBoot(true) }
+    }
+
+    @Test
+    fun `updateCertificateSource calls repository`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updateCertificateSource(CertificateSource.CUSTOM)
+        advanceUntilIdle()
+
+        coVerify { settingsRepository.updateCertificateSource(CertificateSource.CUSTOM) }
+    }
+
+    @Test
+    fun `updateCertificateHostname with valid hostname clears error and saves`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updateCertificateHostname("my-device.local")
+        advanceUntilIdle()
+
+        assertEquals("my-device.local", viewModel.hostnameInput.value)
+        assertNull(viewModel.hostnameError.value)
+        coVerify { settingsRepository.updateCertificateHostname("my-device.local") }
+    }
+
+    @Test
+    fun `updateCertificateHostname with empty hostname sets error`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updateCertificateHostname("")
+        advanceUntilIdle()
+
+        assertEquals("", viewModel.hostnameInput.value)
+        assertEquals("Hostname is required", viewModel.hostnameError.value)
+        coVerify(exactly = 0) { settingsRepository.updateCertificateHostname("") }
+    }
+
+    @Test
+    fun `updateCertificateHostname with invalid format sets error`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updateCertificateHostname("-invalid")
+        advanceUntilIdle()
+
+        assertEquals("-invalid", viewModel.hostnameInput.value)
+        assertEquals("Invalid hostname format", viewModel.hostnameError.value)
+        coVerify(exactly = 0) { settingsRepository.updateCertificateHostname("-invalid") }
+    }
+
+    @Test
+    fun `updateCertificateHostname with single label hostname succeeds`() = runTest {
+        advanceUntilIdle()
+
+        viewModel.updateCertificateHostname("mydevice")
+        advanceUntilIdle()
+
+        assertNull(viewModel.hostnameError.value)
+        coVerify { settingsRepository.updateCertificateHostname("mydevice") }
+    }
+}
```

> **Implementation Note**: The test uses `relaxed = true` for the mock to avoid having to stub every method. The `configFlow` is a `MutableStateFlow` that emits the initial config. `advanceUntilIdle()` is called after each action to allow coroutines on the test dispatcher to complete. The `ServerConfig` constructor parameters must match the actual data class from Plan 2 -- at implementation time, verify the exact parameter names and add any missing fields.

> **Implementation Note on Turbine**: Although Turbine is included as a dependency, most tests in this file use direct `.value` access on StateFlow which is simpler for synchronous assertions. Turbine's `test {}` block would be used for testing asynchronous Flow emissions with timing, but since `advanceUntilIdle()` handles dispatcher advancement, direct value assertions are sufficient and more readable.

> **Implementation Note — Missing tests**: Tests for `addServerLogEntry()` and `MAX_LOG_ENTRIES` trimming logic should be added at implementation time. Tests for `ServerLogsSection` rendering should also be added to `MainActivityTest`.

---

### Task 3.8: Add Integration Tests for MainActivity UI

**Description**: Write instrumented (androidTest) integration tests that verify the Compose UI renders correctly and responds to user interactions.

**Acceptance Criteria**:
- [ ] Test HomeScreen renders server status section
- [ ] Test HomeScreen renders configuration section
- [ ] Test HomeScreen renders permissions section
- [ ] Test HomeScreen renders connection info section
- [ ] Test port input shows validation error for invalid port
- [ ] Test security warning dialog appears when selecting NETWORK binding
- [ ] Test bearer token copy button exists
- [ ] All tests use `createAndroidComposeRule<MainActivity>()`
- [ ] All tests use Hilt test module for DI
- [ ] All tests pass

**Tests**: This IS the test task. Run with `./gradlew connectedAndroidTest` (requires emulator/device).

#### Action 3.8.1: Create `MainActivityTest.kt`

**What**: Create instrumented UI tests for the main activity and its composables.

**Context**: These tests use `createAndroidComposeRule<MainActivity>()` which launches the actual activity in an instrumented test environment. Hilt is used for DI, with a test module that provides a mock `SettingsRepository`. The tests verify that UI elements render and interactions work correctly.

**File**: `app/src/androidTest/kotlin/com/danielealbano/androidremotecontrolmcp/ui/MainActivityTest.kt`

```diff
--- /dev/null
+++ b/app/src/androidTest/kotlin/com/danielealbano/androidremotecontrolmcp/ui/MainActivityTest.kt
@@ -0,0 +1,99 @@
+package com.danielealbano.androidremotecontrolmcp.ui
+
+import androidx.compose.ui.test.assertIsDisplayed
+import androidx.compose.ui.test.junit4.createAndroidComposeRule
+import androidx.compose.ui.test.onNodeWithText
+import androidx.compose.ui.test.performClick
+import androidx.compose.ui.test.performTextClearance
+import androidx.compose.ui.test.performTextInput
+import androidx.test.ext.junit.runners.AndroidJUnit4
+import dagger.hilt.android.testing.HiltAndroidRule
+import dagger.hilt.android.testing.HiltAndroidTest
+import org.junit.Before
+import org.junit.Rule
+import org.junit.Test
+import org.junit.runner.RunWith
+
+@HiltAndroidTest
+@RunWith(AndroidJUnit4::class)
+class MainActivityTest {
+
+    @get:Rule(order = 0)
+    val hiltRule = HiltAndroidRule(this)
+
+    @get:Rule(order = 1)
+    val composeTestRule = createAndroidComposeRule<MainActivity>()
+
+    @Before
+    fun setUp() {
+        hiltRule.inject()
+    }
+
+    @Test
+    fun appBarTitleIsDisplayed() {
+        composeTestRule
+            .onNodeWithText("MCP Remote Control")
+            .assertIsDisplayed()
+    }
+
+    @Test
+    fun serverStatusSectionIsDisplayed() {
+        composeTestRule
+            .onNodeWithText("Server Status")
+            .assertIsDisplayed()
+    }
+
+    @Test
+    fun serverStartButtonIsDisplayed() {
+        composeTestRule
+            .onNodeWithText("Start")
+            .assertIsDisplayed()
+    }
+
+    @Test
+    fun configurationSectionIsDisplayed() {
+        composeTestRule
+            .onNodeWithText("Configuration")
+            .assertIsDisplayed()
+    }
+
+    @Test
+    fun bindingAddressLocalhostIsDisplayed() {
+        composeTestRule
+            .onNodeWithText("Localhost (127.0.0.1)")
+            .assertIsDisplayed()
+    }
+
+    @Test
+    fun portFieldIsDisplayed() {
+        composeTestRule
+            .onNodeWithText("Port")
+            .assertIsDisplayed()
+    }
+
+    @Test
+    fun permissionsSectionIsDisplayed() {
+        composeTestRule
+            .onNodeWithText("Permissions")
+            .assertIsDisplayed()
+    }
+
+    @Test
+    fun connectionInfoSectionIsDisplayed() {
+        composeTestRule
+            .onNodeWithText("Connection Info")
+            .assertIsDisplayed()
+    }
+
+    @Test
+    fun networkBindingShowsSecurityWarningDialog() {
+        composeTestRule
+            .onNodeWithText("Network (0.0.0.0)")
+            .performClick()
+
+        composeTestRule
+            .onNodeWithText("Network Exposure Warning")
+            .assertIsDisplayed()
+
+        composeTestRule
+            .onNodeWithText("Cancel")
+            .performClick()
+    }
+
+    @Test
+    fun autoStartToggleIsDisplayed() {
+        composeTestRule
+            .onNodeWithText("Auto-start on boot")
+            .assertIsDisplayed()
+    }
+}
```

> **Implementation Note**: These integration tests require a Hilt test runner and possibly a custom `HiltTestApplication`. At implementation time, ensure that:
> 1. The `androidTestImplementation` dependency for `hilt-android-testing` is present (add to `libs.versions.toml` and `app/build.gradle.kts` if missing from Plan 1).
> 2. A custom `HiltTestRunner` is configured in `app/build.gradle.kts` via `testInstrumentationRunner = "com.danielealbano.androidremotecontrolmcp.HiltTestRunner"` if needed.
> 3. A `HiltTestRunner.kt` class exists in the `androidTest` source set.

> **IMPORTANT — Missing dependency**: The integration tests require `hilt-android-testing` and `hilt-android-compiler` (as `kspAndroidTest`), plus a `HiltTestRunner` class and `testInstrumentationRunner` update in `app/build.gradle.kts`. These must be added as an explicit action at implementation time — they are not included in Plan 1's dependency list.

> **Implementation Note on test scope**: The integration tests verify that UI elements render correctly using string matching. They do not deeply test ViewModel logic (that is covered by unit tests in Task 3.6). The security warning dialog test verifies the full user flow: click Network binding -> dialog appears -> click Cancel to dismiss.

---

### Task 3.9: Verification, Linting, and Build

**Description**: Run all verification commands to ensure the UI layer is correct. Fix any lint or build issues. Run the unit tests.

**Acceptance Criteria**:
- [ ] `make build` succeeds without errors or warnings
- [ ] `make lint` succeeds without errors or warnings
- [ ] `make test-unit` passes (including MainViewModelTest)

**Tests**: These are the verification steps.

#### Action 3.9.1: Run `make lint`

**What**: Verify no linting errors or warnings exist.

**Command**:
```bash
cd /home/daalbano/dev/android-remote-control-mcp
make lint
```

**Expected outcome**: BUILD SUCCESSFUL with no ktlint or detekt violations.

**If it fails**: Run `make lint-fix` for auto-fixable issues (trailing commas, import ordering, etc.), then re-run `make lint`. For non-auto-fixable issues, manually fix the code.

---

#### Action 3.9.2: Run `make build`

**What**: Verify the project compiles successfully with the new UI layer.

**Command**:
```bash
cd /home/daalbano/dev/android-remote-control-mcp
make build
```

**Expected outcome**: BUILD SUCCESSFUL, debug APK generated.

**If it fails**: Common issues to check:
- Missing imports (verify all Plan 2 classes are available: `ServerConfig`, `ServerStatus`, `BindingAddress`, `CertificateSource`, `SettingsRepository`, `NetworkUtils`, `PermissionUtils`)
- Missing `hilt-navigation-compose` dependency (Task 3.5)
- Missing `hilt-android-testing` dependency for androidTest
- String resource reference errors (verify all `R.string.*` references have entries in `strings.xml`)
- Compose compiler errors (verify `kotlin-compose` plugin is applied)

---

#### Action 3.9.3: Run `make test-unit`

**What**: Run unit tests including the new MainViewModelTest.

**Command**:
```bash
cd /home/daalbano/dev/android-remote-control-mcp
make test-unit
```

**Expected outcome**: All tests pass, including all MainViewModelTest cases.

**If it fails**: Check test output for specific failure messages. Common issues:
- MockK setup errors (verify `relaxed = true` or explicit stubs)
- Dispatcher issues (verify `setMain`/`resetMain` in setUp/tearDown)
- Missing `ServerConfig` constructor parameters (align with Plan 2 data class)

---

#### Action 3.9.4: Create the feature branch and commits

**What**: Create the `feat/ui-layer-compose` branch and make all 6 commits as defined in the commit strategy.

**Commands**:
```bash
cd /home/daalbano/dev/android-remote-control-mcp

# Ensure main is up to date
git checkout main
git pull origin main

# Create and switch to feature branch
git checkout -b feat/ui-layer-compose

# Commit 1: Material 3 theme
git add app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/theme/Color.kt \
        app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/theme/Type.kt \
        app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/theme/Theme.kt
git commit -m "$(cat <<'EOF'
feat: add Material 3 theme with light and dark mode support

Define blue-purple color palette for light and dark schemes,
Material 3 typography with system fonts, and theme composable
with dynamic color (Material You) support on Android 12+.

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"

# Commit 2: MainViewModel
git add app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModel.kt
git commit -m "$(cat <<'EOF'
feat: add MainViewModel with settings state management

Create HiltViewModel that manages all UI state via StateFlows,
validates port and hostname input, persists settings through
SettingsRepository, and provides clipboard and permission
refresh utilities. Server start/stop are stubs for Plan 6.

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"

# Commit 3: Compose UI components
git add app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ServerStatusCard.kt \
        app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ConfigurationSection.kt \
        app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ConnectionInfoCard.kt \
        app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/PermissionsSection.kt
git commit -m "$(cat <<'EOF'
feat: add Compose UI components for server control

Create ServerStatusCard with animated status indicator and
start/stop button, ConfigurationSection with binding address
selector, port input with validation, bearer token display
with copy/regenerate, auto-start toggle, HTTPS certificate
settings, and security warning dialog for network binding.
Add ConnectionInfoCard and PermissionsSection components.

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"

# Commit 4: Server logs viewer data model and UI component
git add app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/data/model/ServerLogEntry.kt \
        app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/components/ServerLogsSection.kt
git commit -m "$(cat <<'EOF'
feat: add server logs viewer data model and UI component

Create ServerLogEntry data class for log entries and
ServerLogsSection composable with scrollable list display.
Update MainViewModel with serverLogs StateFlow (bounded to
100 entries). The log list is empty at this stage; actual
entries will be emitted by McpServerService in Plan 6.

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"

# Commit 5: HomeScreen, MainActivity, strings.xml, and dependency update
git add app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/screens/HomeScreen.kt \
        app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModel.kt \
        app/src/main/kotlin/com/danielealbano/androidremotecontrolmcp/ui/MainActivity.kt \
        app/src/main/res/values/strings.xml \
        gradle/libs.versions.toml \
        app/build.gradle.kts
git commit -m "$(cat <<'EOF'
feat: add HomeScreen and update MainActivity with Compose UI

Create HomeScreen composable that assembles all UI sections
including ServerLogsSection with scrollable layout and
lifecycle-aware permission refresh. Update MainActivity to use
AndroidRemoteControlMcpTheme and HomeScreen. Add all UI string
resources including security warning dialog text and server
logs strings. Add hilt-navigation-compose dependency.

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"

# Commit 6: Unit tests
git add app/src/test/kotlin/com/danielealbano/androidremotecontrolmcp/ui/viewmodels/MainViewModelTest.kt
git commit -m "$(cat <<'EOF'
test: add unit tests for MainViewModel

Test initial state loading, port validation (valid, too low,
too high, non-numeric, empty, boundary values), binding address
update, bearer token regeneration, auto-start toggle, certificate
source update, and hostname validation (valid, empty, invalid
format). Uses MockK and coroutines-test with StandardTestDispatcher.

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"

# Commit 7: Integration tests
git add app/src/androidTest/kotlin/com/danielealbano/androidremotecontrolmcp/ui/MainActivityTest.kt
git commit -m "$(cat <<'EOF'
test: add integration tests for MainActivity UI

Verify all UI sections render correctly: app bar title, server
status card, configuration section with binding address and port,
permissions section, server logs section, and connection info
card. Test security warning dialog appears when selecting network
binding address. Uses HiltAndroidTest with createAndroidComposeRule.

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"
```

---

#### Action 3.9.5: Push and create PR

**What**: Push the branch and create the pull request.

**Commands**:
```bash
cd /home/daalbano/dev/android-remote-control-mcp

# Push feature branch
git push -u origin feat/ui-layer-compose

# Create PR
gh pr create --base main --title "Plan 3: UI layer with Jetpack Compose and Material Design 3" --body "$(cat <<'EOF'
## Summary

Complete UI layer implementation using Jetpack Compose with Material Design 3. Creates the theme system (light/dark with Material You support), MainViewModel for state management, five UI component sections (ServerStatusCard, ConfigurationSection, PermissionsSection, ServerLogsSection, ConnectionInfoCard), HomeScreen layout, and updated MainActivity.

## Plan Reference

Implementation of Plan 3: UI Layer (MainActivity + Jetpack Compose) from `docs/plans/3_ui-layer-compose_20260211163214.md`.

## Changes

- Material 3 theme: Color.kt (blue-purple palette), Type.kt (system fonts), Theme.kt (dynamic colors)
- MainViewModel: settings state management, input validation, clipboard, permission refresh
- ServerStatusCard: animated status indicator, start/stop button
- ConfigurationSection: binding address selector, port input, bearer token, auto-start, HTTPS certificate
- ConnectionInfoCard: IP, port, URL, masked token, copy-all
- PermissionsSection: accessibility and notification permission status with enable buttons
- ServerLogsSection: scrollable log viewer with bounded list (empty at this stage, wired in Plan 6)
- ServerLogEntry data model with timestamp, toolName, params, durationMs
- HomeScreen: scrollable layout assembling all sections
- MainActivity: updated to use theme and HomeScreen
- strings.xml: all UI strings including security warning dialog
- hilt-navigation-compose dependency added

## Testing

- Unit tests: MainViewModelTest (16+ test cases covering validation, state, repository calls, and server log entry management)
- Integration tests: MainActivityTest (11+ test cases covering section rendering, interactions, and server logs section)
- `make build` succeeds
- `make lint` passes
- `make test-unit` passes

## Checklist

- [ ] All tests pass (`make test-unit`)
- [ ] Lint passes (`make lint`)
- [ ] Build succeeds (`make build`)
- [ ] CI validated locally (`gh act --validate`)

🤖 Generated with [Claude Code](https://claude.com/claude-code)
EOF
)"
```

---

## Performance, Security, and QA Review

### Performance

- **Recomposition efficiency**: All composables use state hoisting, meaning recomposition is scoped to the smallest affected subtree. The `ConfigurationSection` has many inputs but each triggers targeted recomposition via individual StateFlow values (portInput, hostnameInput) rather than a single monolithic state object. The `ServerLogsSection` uses `LazyColumn` for efficient rendering of up to 100 log entries with bounded height.
- **Animation overhead**: The `animateColorAsState` in `ServerStatusCard` uses a 300ms tween which is lightweight and appropriate. No continuous animations are running.
- **Scroll performance**: The HomeScreen uses `verticalScroll` on a `Column` rather than `LazyColumn`. This is appropriate because the content is fixed (4 cards) and does not require lazy loading. All items are composed at once which is acceptable for this small number of elements.
- **StateFlow collection**: `collectAsStateWithLifecycle()` is used instead of `collectAsState()` to stop collection when the activity is in the background, reducing unnecessary work.
- **ViewModel coroutines**: All repository calls use `Dispatchers.IO` to avoid blocking the main thread. Settings updates are fire-and-forget within `viewModelScope`.

### Security

- **Bearer token masking**: The bearer token is masked by default in both ConfigurationSection and ConnectionInfoCard using `PasswordVisualTransformation`. Users must explicitly toggle visibility.
- **Security warning dialog**: The 0.0.0.0 binding address triggers a mandatory warning dialog before the setting is applied. The user must confirm by clicking "I Understand, Continue". The dialog text matches PROJECT.md exactly.
- **No token logging**: The `copyToClipboard` method does not log the token value. The `ClipData` label is generic ("MCP Remote Control").
- **Input validation**: Port is validated to be a number in range 1-65535. Hostname is validated against a regex pattern. Invalid inputs are rejected before reaching the repository.
- **No sensitive data in state restoration**: Bearer token is stored in SettingsRepository (DataStore), not in `rememberSaveable`. Configuration changes are not saved in instance state bundles.
- **Server logs sanitization**: Server log entries truncate params to 100 characters and do not log response data, avoiding exposure of sensitive response payloads in the UI.

### QA

- **Accessibility**: All icons have `contentDescription`, interactive elements use standard Material 3 components which include built-in accessibility support (ripple, focus management, screen reader labels). The `PermissionRow` status icons include descriptive content descriptions ("Accessibility Service enabled/disabled").
- **Dark mode**: The theme supports both light and dark modes via `isSystemInDarkTheme()` and dynamic colors on Android 12+. All colors are defined in paired light/dark schemes. No hardcoded colors are used in composables (except status indicator colors which are intentionally fixed for consistency across themes).
- **Touch targets**: Material 3 components (`IconButton`, `Switch`, `RadioButton`, `SegmentedButton`, `OutlinedButton`, `FilledTonalButton`) all meet the 48dp minimum touch target requirement by default.
- **Edge cases in validation**: Port validation handles empty string, non-numeric, below minimum (0), above maximum (65536), and boundary values (1, 65535). Hostname validation handles empty string and invalid format (leading hyphen).
- **Test coverage**: 16+ unit tests cover all ViewModel paths (validation branches, repository calls, initial state, server log entry management). 11+ integration tests verify all UI sections render (including ServerLogsSection) and the security dialog flow works.
- **String resources**: All user-visible strings are in `strings.xml` for localization. No hardcoded strings in composables.
- **Missing dependency note**: The plan includes Task 3.5 to add `hilt-navigation-compose` which is required by `hiltViewModel()` but was not included in Plan 1's dependency list. At implementation time, also verify that `hilt-android-testing` is available for the androidTest integration tests.

---

## File Inventory

All files created or modified in this plan:

| # | File Path | Task | Action |
|---|-----------|------|--------|
| 1 | `app/src/main/kotlin/.../ui/theme/Color.kt` | 3.1 | Create |
| 2 | `app/src/main/kotlin/.../ui/theme/Type.kt` | 3.1 | Create |
| 3 | `app/src/main/kotlin/.../ui/theme/Theme.kt` | 3.1 | Create |
| 4 | `app/src/main/kotlin/.../ui/viewmodels/MainViewModel.kt` | 3.2 | Create |
| 5 | `app/src/main/kotlin/.../ui/components/ServerStatusCard.kt` | 3.3 | Create |
| 6 | `app/src/main/kotlin/.../ui/components/ConfigurationSection.kt` | 3.3 | Create |
| 7 | `app/src/main/kotlin/.../ui/components/ConnectionInfoCard.kt` | 3.3 | Create |
| 8 | `app/src/main/kotlin/.../ui/components/PermissionsSection.kt` | 3.3 | Create |
| 9 | `app/src/main/kotlin/.../data/model/ServerLogEntry.kt` | 3.6 | Create |
| 10 | `app/src/main/kotlin/.../ui/components/ServerLogsSection.kt` | 3.6 | Create |
| 11 | `app/src/main/kotlin/.../ui/screens/HomeScreen.kt` | 3.4 | Create |
| 12 | `app/src/main/kotlin/.../ui/MainActivity.kt` | 3.4 | Modify |
| 13 | `app/src/main/res/values/strings.xml` | 3.4, 3.6 | Modify |
| 14 | `gradle/libs.versions.toml` | 3.5 | Modify |
| 15 | `app/build.gradle.kts` | 3.5 | Modify |
| 16 | `app/src/test/kotlin/.../ui/viewmodels/MainViewModelTest.kt` | 3.7 | Create |
| 17 | `app/src/androidTest/kotlin/.../ui/MainActivityTest.kt` | 3.8 | Create |

**Note**: All paths with `...` expand to `com/danielealbano/androidremotecontrolmcp`

**Total**: 13 new files, 4 modified files

---

**End of Plan 3**
